System.register("chunks:///_virtual/activityManager.ts",["cc","./PrefabManager.ts","./homeBottom.ts","./Global.ts","./ToastManager.ts"],(function(t){var e,n,o,a,i,c,s,d,r;return{setters:[function(t){e=t.cclegacy,n=t.Component,o=t.instantiate,a=t.Label,i=t._decorator},function(t){c=t.PrefabManager},function(t){s=t.homeBottom},function(t){d=t.Global},function(t){r=t.ToastManager}],execute:function(){var m;e._RF.push({},"92fb7sDHXJOmLywKNy1CZ1F","activityManager",void 0);const{ccclass:g,property:h}=i;t("activityManager",g("activityManager")(m=class extends n{onLoad(){let t=o(c.getInstance().get("bottom"));t.getComponent(s).init(3),this.node.getChildByName("bottom").addChild(t),t=o(c.getInstance().get("header")),this.node.getChildByName("header").addChild(t)}start(){this.init()}init(){this.node.getChildByPath("content/share/info/content/textCont/num").getComponent(a).string=d.Instance.get("inviteNum");this.node.getChildByPath("content/share/info/content/textCont-1/num").getComponent(a).string=d.Instance.get("inviteGold")}shareBtnClick(t,e){const n="https://t.me/eatMeeeeebot/eatme?startapp="+btoa(d.Instance.get("inviteCode")),o=document.createElement("input");o.value=n,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),r.show("Link copyed",2)}})||m);e._RF.pop()}}}));

System.register("chunks:///_virtual/AudioManager.ts",["cc"],(function(s){var t,i,n,o,e,a;return{setters:[function(s){t=s.cclegacy,i=s._decorator,n=s.Component,o=s.AudioSource,e=s.resources,a=s.AudioClip}],execute:function(){var d,h;t._RF.push({},"7993ffNAsZDYJNQh8G96fuC","AudioManager",void 0);const{ccclass:u,property:r}=i;s("AudioManager",u("AudioManager")(((h=class s extends n{constructor(){super(...arguments),this.audioSource=null,this.sndAudioSource=null,this.isSndOn=!0,this.isBgmOn=!0,this.bgmPath="/bgm",this.sndPath="/snd",this.bgms={},this.snds={}}static getInstance(){return s.instance}setBgmPath(s){this.bgmPath=s}setSndPath(s){this.sndPath=s}onLoad(){s.instance=this;let t=this.node.getComponents(o);this.audioSource=t[0],this.sndAudioSource=t[1],this.isBgmOn=!0,this.isSndOn=!0}async load(){await this.loadBgm(),await this.loadSnd()}async loadBgm(){return new Promise(((s,t)=>{e.loadDir(this.bgmPath,a,((i,n)=>{if(i)t(i);else{for(let s=0;s<n.length;s++)this.bgms[n[s].name]=n[s];s(n)}}))}))}async loadSnd(){return new Promise(((s,t)=>{e.loadDir(this.sndPath,a,((i,n)=>{if(i)t(i);else{for(let s=0;s<n.length;s++)this.snds[n[s].name]=n[s];s(n)}}))}))}playBgm(s){this.bgms.hasOwnProperty(s)&&(this.audioSource.playing&&this.audioSource.stop(),this.audioSource.clip=this.bgms[s],this.isBgmOn?this.audioSource.play():this.audioSource.pause())}playSnd(s,t){void 0===t&&(t=null),this.snds.hasOwnProperty(s)&&this.isSndOn&&(t?(t.clip=this.snds[s],t.play()):(this.sndAudioSource.clip=this.snds[s],this.sndAudioSource.play()))}stopSnd(s,t){void 0===t&&(t=null),this.snds.hasOwnProperty(s)&&(t&&t.clip===this.snds[s]?t.stop():this.sndAudioSource.clip===this.snds[s]&&this.sndAudioSource.stop())}}).instance=null,d=h))||d);t._RF.pop()}}}));

System.register("chunks:///_virtual/bagManager.ts",["cc","./Utils.ts","./PrefabManager.ts","./SpriteManager.ts","./homeBottom.ts","./DrawSquare.ts","./Global.ts","./ToastManager.ts","./AudioManager.ts","./httpService.ts"],(function(t){var e,n,i,a,o,s,l,c,r,d,h,p,g,u,v,f,C,m,y,I,B;return{setters:[function(t){e=t.cclegacy,n=t.Component,i=t.Node,a=t.instantiate,o=t.find,s=t.Label,l=t.Sprite,c=t.Vec3,r=t.Button,d=t.UIOpacity,h=t.tween,p=t._decorator},function(t){g=t.default},function(t){u=t.PrefabManager},function(t){v=t.SpriteManager},function(t){f=t.homeBottom},function(t){C=t.DrawSquare},function(t){m=t.Global},function(t){y=t.ToastManager},function(t){I=t.AudioManager},function(t){B=t.default}],execute:function(){var N;e._RF.push({},"a23adnZ3E9CR46inhLxGJJE","bagManager",void 0);const{ccclass:U,property:b}=p;t("bagManager",U("bagManager")(N=class extends n{constructor(){super(...arguments),this.needScaleX=[1004,1010,1011,1012],this.needScaleY=[1008],this.alertNode=null,this.bagData={},this.levelUpInfo={},this.fruitTalents={},this.detailFruitID=null,this.levelUpMoney=null,this.levelUpChip=null,this.levelUpBtnHasBindClick=!1,this.httpService=void 0,this.loadingContainer=null}onLoad(){this.alertNode=this.node.getChildByName("alert"),this.alertNode.active=!1,this.loadingContainer=this.node.getChildByName("loading"),this.alertNode.on(i.EventType.TOUCH_START,(function(t){}),this),this.httpService=new B,this.fetchDataFromServer();let t=a(u.getInstance().get("loading"));this.loadingContainer.addChild(t),this.loadingContainer.active=!1}start(){let t=a(u.getInstance().get("bottom"));t.getComponent(f).init(1),this.node.getChildByName("bottom").addChild(t),t=a(u.getInstance().get("header")),this.node.getChildByName("header").addChild(t)}async fetchDataFromServer(){const t=m.Instance.fruitLevels,e={};for(const n of Object.keys(t)){const i=t[n];e[`${i.fruit_id}-${i.level}`]=i}this.levelUpInfo=e,this.createProducts()}createProducts(){const t=o("ScrollView/view/content/owned/item",this.node);t.removeAllChildren();const e=m.Instance.fruits,n=this.levelUpInfo;let r=[],d=[];for(const t of Object.keys(e)){const o=e[t],h=parseInt(o.fruit_id),p=m.Instance.getUserFruitById(h);let f=0,y=!1,I=0;g.isEmpty(p)||(f=p.fruit_level,y=!0,I=p.fragments);let B=f+1,N=h+"-"+(B>=9?9:B);if(g.isEmpty(n[N]))continue;const U=a(u.getInstance().get("fruitCard")),b=U.getChildByName("title");b&&(b.getComponent(s).string=o.name);let S="item-green";2==o.quality?S="item-blue":3==o.quality&&(S="item-purple"),U.getComponent(l).spriteFrame=v.getInstance().get(S),U.getChildByName("square").getComponent(C).drawShapeByIndex(o.grid_index);let _=v.getInstance().get(h+"-1");const F=U.getChildByName("img");let k=new c(1,1,1);const w=m.Instance.fruitNeedScaleX,D=m.Instance.fruitNeedScaleY;-1!=w.indexOf(h)&&(k.x=.5),-1!=D.indexOf(h)&&(k.y=.5),1010==h&&(k.x=.3),F.scale=k,F.getComponent(l).spriteFrame=_;const M=U.getChildByName("level");if(y){M&&(f>0?M.getComponent(s).string="Level "+f:M.active=!1);const t=n[N].up_cost_piece,e=U.getChildByName("bar");e.getChildByName("up").active=!1,e.getChildByName("chip").active=!0,I>=t&&(e.getChildByName("up").active=!0,e.getChildByName("chip").active=!1);e.getChildByName("num").getComponent(s).string=I+" / "+n[N].up_cost_piece}else F.getComponent(l).grayscale=!0,U.getComponent(l).grayscale=!0,U.getChildByName("bar").active=!1,U.getChildByName("desc").active=!0,M&&(M.active=!1);if(y){let t={fruitId:h,needScale:k,levelCost:n[N].up_cost_piece};U.on(i.EventType.TOUCH_END,(()=>this.showDetailAlert(t)),this),r.push(U)}else d.push(U)}if(!g.isEmpty(r))for(const e in r){const n=r[e];t.addChild(n)}if(!g.isEmpty(d))for(const e in d){const n=d[e];t.addChild(n)}}showDetailAlert(t){I.getInstance().playSnd("clickBtn"),this.detailAlertAppendData(t),this.alertNode.active=!0}detailAlertAppendData(t,e){void 0===e&&(e="init"),this.detailFruitID=t.fruitId;const n=m.Instance.getUserFruitById(this.detailFruitID);if(g.isEmpty(n))return void y.show("fruit not obtained",2);let i=m.Instance.getFruitById(this.detailFruitID);const a=o("body/box-1",this.alertNode),c=n.fruit_level,d=n.fragments,h=n.attack&&n.attack>0?n.attack:"-",p=n.atk_speed&&n.atk_speed>0?n.atk_speed:"-";if("init"==e){o("title",a).getComponent(s).string=i.name;o("desc/text",a).getComponent(s).string=i.desc;const e=o("left/icon",a);e.scale=t.needScale,e.getComponent(l).spriteFrame=v.getInstance().get(this.detailFruitID+"-1")}const u=o("left/level",a).getComponent(s);u.string=c>0?"Level "+c:"";o("left/chip/text",a).getComponent(s).string=d+" / "+t.levelCost,a.getChildByPath("left/chip/icon").active=!0,a.getChildByPath("left/chip/up").active=!1,d>=t.levelCost&&(a.getChildByPath("left/chip/icon").active=!1,a.getChildByPath("left/chip/up").active=!0);const f=c+1;o("info/attack/desc",a).getComponent(s).string=h;o("info/speed/desc",a).getComponent(s).string=(p/10).toString();o("info/target/desc",a).getComponent(s).string=1001==this.detailFruitID?"Random":"Frontmost";const C=this.detailFruitID+"-"+(f>=9?9:f),I=o("body/LevelUpBtn",this.alertNode);if(f>=9)I.active=!1;else{const t=this.levelUpInfo,n=I.getChildByName("coinNum");this.levelUpMoney=t[C].up_cost_gold,this.levelUpChip=t[C].up_cost_piece,n.getComponent(s).string=this.levelUpMoney.toString(),"init"!=e||this.levelUpBtnHasBindClick||(I.on(r.EventType.CLICK,(()=>this.onLevelUpBtnClick()),this),this.levelUpBtnHasBindClick=!0);const i=m.Instance.fruitTalents,a=o("body/box-2/tianfu",this.alertNode);var B=1;for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const e=i[t];if(e.fruit_id!=this.detailFruitID)continue;var N=e.desc;-1!==N.indexOf("#")&&(N=N.replace("#","【"+e.name+"】")),-1!==N.indexOf("X")&&(N=N.replace(/X/g,e.value));let n=!1;const r=o(B.toString(),a).getComponent(l);c<parseInt(e.unlock)&&(r.grayscale=!0,n=!0);const d=o(B+"/unlock",a);d.getComponent(s).string=`Lv ${e.unlock}`,d.active=!0,n||(r.grayscale=!1),o(B+"/desc",a).getComponent(s).string=N,B++}}}onAlertCloseBtnClick(){I.getInstance().playSnd("clickBtn"),this.alertNode.active=!1}async onLevelUpBtnClick(){const t=o("body/LevelUpBtn",this.alertNode).getComponent(r);t.interactable=!1,I.getInstance().playSnd("clickBtn");const e=this.detailFruitID,n=m.Instance.getUserFruitById(e).fragments,i=m.Instance.get("golds");if(n>=this.levelUpChip&&i>=this.levelUpMoney){this.loadingContainer.active=!0;const t=await this.httpService.postDataToService("bag/upgradeFruit",{fruitId:e});if(this.loadingContainer.active=!1,!g.isEmpty(t.code))return void y.show(t.msg,2);const n=t.costGold,i=(t.costPiece,t.currentLevel),a=this.levelUpInfo,s=o("body/up",this.alertNode);for(let t=0;t<s.children.length;t++){let e=s.children[t];this.scheduleOnce((()=>{this.showAndMoveUp(e)}),.2*t)}m.Instance.updateGolds(-n),await m.Instance.updateFruit();let l={fruitId:e,levelCost:a[e+"-"+(i+1)].up_cost_piece};this.detailAlertAppendData(l,"level-up"),I.getInstance().playSnd("levelUp"),this.createProducts()}else n<this.levelUpChip?y.show("Out of Chips",2):i<this.levelUpMoney&&y.show("Out of Golds",2);this.scheduleOnce((()=>{t.interactable=!0}),1)}showAndMoveUp(t){t.active=!0;let e=t.getComponent(d);e.opacity=180,t.setPosition(new c(0,0,0));let n=h(t).to(1,{position:new c(0,500,0)},{easing:"cubicOut"}),i=h(e).to(1,{opacity:0});n.start(),i.call((()=>{t.active=!1})).start()}})||N);e._RF.pop()}}}));

System.register("chunks:///_virtual/BaseApp.ts",["cc"],(function(t){var e,s,n,c;return{setters:[function(t){e=t.cclegacy,s=t._decorator,n=t.Component,c=t.director}],execute:function(){var a,o;e._RF.push({},"a5f1fQkYFNO3oKTrukVfxtR","BaseApp",void 0);const{ccclass:r,property:i}=s;t("BaseApp",r("BaseApp")(((o=class t extends n{static getInstance(){return t.instance}onLoad(){t.instance=this,c.addPersistRootNode(this.node)}start(){}}).instance=null,a=o))||a);e._RF.pop()}}}));

System.register("chunks:///_virtual/Buff.ts",["cc","./Utils.ts","./Pack.ts","./Fruit.ts","./GameScene.ts","./Monster.ts","./TDGame.ts","./MainUI.ts","./FruitManager.ts"],(function(t){var e,f,s,n,u,i,o,c,r,a,d;return{setters:[function(t){e=t.cclegacy,f=t._decorator,s=t.Component},function(t){n=t.default},function(t){u=t.Pack},function(t){i=t.Fruit},function(t){o=t.GameScene},function(t){c=t.Monster},function(t){r=t.TDGame},function(t){a=t.MainUI},function(t){d=t.FruitManager}],execute:function(){var l,B;e._RF.push({},"7694aX3v4RMfqKMG8uOKbMT","Buff",void 0);const{ccclass:h,property:p}=f;t("Buff",h("Buff")(((B=class t extends s{constructor(){super(...arguments),this.monsterDeBuff=[],this.fruitBuff=[],this.onlyOnceBuff=[]}static getInstance(){return t.instance}onLoad(){t.instance=this}newFruitApplyBuffs(t){if(!n.isEmpty(this.fruitBuff))for(const e in this.fruitBuff)if(Object.prototype.hasOwnProperty.call(this.fruitBuff,e)){const f=this.fruitBuff[e],{type:s,fruitId:n,addNum:u}=f;n?n==t.fruitId&&this.doAddBuff(t,s,u):this.doAddBuff(t,s,u)}}applyBuffs(t,e,f,s){5==e?(this.monsterDeBuff.push({type:e,addNum:f}),this.addBuffToAllMonster(e,f)):6==e?(r.getInstance().addSilver(f),a.getInstance().updateSilverNum()):7==e?r.getInstance().gameLevel.levelAddSliver+=f:8==e?d.getInstance().extraLv2Fruit=!0:9==e?this.onlyOnceBuff.includes(e)||(a.getInstance().victoryAdd=f,this.onlyOnceBuff.push(e)):10==e?this.onlyOnceBuff.includes(e)||(this.monsterDeBuff.push({type:e,addNum:f}),this.addBuffToAllMonster(e,f),this.onlyOnceBuff.push(e)):(t?this.addBuffToFruit(t,e,f,s):this.addBuffToAll(e,f),this.fruitBuff.push({type:e,time:s,addNum:f,fruitId:t}))}addBuffToAll(t,e){const f=u.getInstance().attachNode.children;for(let s=0;s<f.length;s++){let n=f[s].getComponent(i);this.doAddBuff(n,t,e)}}addBuffToFruit(t,e,f,s){const n=u.getInstance().attachNode.children;for(let u=0;u<n.length;u++){let o=n[u].getComponent(i);t==o.getFruitId()&&this.doAddBuff(o,e,f,s)}}doAddBuff(t,e,f,s){if(void 0===s&&(s=0),1==e){const e=t.damage,s=Math.ceil(e*(1+f/100));t.setFruitBasicBuff(s)}else if(2==e){const e=t.atkSpeed*(1-f/100);t.setFruitBasicBuff(0,e)}else if(3==e){const e=t.critRate;let s;s=0==e?f/100:e*(1+f/100),t.setFruitBasicBuff(0,0,s)}else if(4==e){const e=t.critDamageMultiplier*(1+f/100);t.setFruitBasicBuff(0,0,0,e)}else 11==e||16==e?t.setSpecBuff(e,f,s):12==e||17==e?t.setSpecBuff(e,f,s,1):14==e?t.setSpecBuff(e,f,0):15==e?t.setStackedAtkSpeed(s,f):18!=e&&19!=e||t.setSpecBuff(e,f,s)}addBuffToAllMonster(t,e){const f=o.getInstance().monsterAttachNode.children;for(let s=0;s<f.length;s++){let n=f[s].getComponent(c);this.doDebuffToMonster(n,t,e)}}newMonsterApplyDeBuffs(t){if(!n.isEmpty(this.monsterDeBuff))for(const e in this.monsterDeBuff)if(Object.prototype.hasOwnProperty.call(this.monsterDeBuff,e)){const f=this.monsterDeBuff[e],{type:s,addNum:n}=f;this.doDebuffToMonster(t,s,n)}}doDebuffToMonster(t,e,f){if(5==e){const e=t.movSpeed*(1-f/100);t.setDeBuff(e)}else if(10==e){const e=t.monsterExp*(1+f/100);t.setDeBuff(0,e)}}}).instance=null,l=B))||l);e._RF.pop()}}}));

System.register("chunks:///_virtual/Bullet.ts",["cc","./NodePoolMap.ts","./GameConfig.ts","./SpriteManager.ts"],(function(t){var e,i,s,a,r,o,h,n,c,l,m,g;return{setters:[function(t){e=t.cclegacy,i=t.Component,s=t.v3,a=t.quat,r=t.ParticleSystem2D,o=t.Sprite,h=t.Vec3,n=t.Quat,c=t._decorator},function(t){l=t.default},function(t){m=t.NodePoolName},function(t){g=t.SpriteManager}],execute:function(){var d;e._RF.push({},"b93c9bL2+hI0o6fi8KID4H8","Bullet",void 0);const{ccclass:u,property:p}=c;t("Bullet",u("Bullet")(d=class extends i{constructor(){super(...arguments),this.inited=!1,this.isDestroy=!1,this.isCrit=!1,this.movSpeed=1200,this.movDir=s(0,0,0),this.rotate=0,this.q=a(0,0,0,0),this._damage=75,this._shooter=null,this._attackTarget=null,this.particleSystem2D=null}get damage(){return this._damage}set damage(t){this._damage=t}set shooter(t){this._shooter=t}get shooter(){return this._shooter}set attackTarget(t){this._attackTarget=t}get attackTarget(){return this._attackTarget}onLoad(){this.particleSystem2D=this.node.getChildByName("Particle").getComponent(r),this.particleSystem2D&&(this.particleSystem2D.life=.1,this.particleSystem2D.startSize=30,this.particleSystem2D.endSize=5,this.particleSystem2D.resetSystem())}setShooterAndTarget(t,e){this.shooter=t,this.attackTarget=e;const i=this.shooter.fruitId;this.node.getChildByName("sprite").getComponent(o).spriteFrame=g.getInstance().get(i+"-1");let s=Math.random()<this.shooter.critRate,a=this.shooter.damage;this.isCrit=!1,s&&(a*=this.shooter.critDamageMultiplier,this.isCrit=!0),this.damage=Math.ceil(a),this.inited=!0}clearAttackTarget(){this.attackTarget=null,this.isDestroy=!0,this.node.active=!1}reset(){this.node.active=!0,this.inited=!1,this.isDestroy=!1,this.movSpeed=1200,this.shooter=null,this.attackTarget=null,this.rotate=0,this.particleSystem2D.resetSystem()}backToPool(){this.node.removeFromParent(),this.reset(),l.put(m.Bullet,this.node)}moveToTarget(t){if(!this.attackTarget)return;if(this.attackTarget.isDeath)return void this.clearAttackTarget();if(h.subtract(this.movDir,this.attackTarget.node.getPosition(),this.node.getPosition()),this.movDir.lengthSqr()<300)this.attackTarget.onDamage(this),this.clearAttackTarget();else{h.normalize(this.movDir,this.movDir),h.multiplyScalar(this.movDir,this.movDir,t*this.movSpeed);let e=this.node.getPosition();e.add(this.movDir),this.node.setPosition(e),this.rotate+=1e3*t,n.fromEuler(this.q,0,0,this.rotate%360),this.node.setRotation(this.q)}}})||d);e._RF.pop()}}}));

System.register("chunks:///_virtual/Damage.ts",["cc"],(function(e){var t,o,n,s,a,i,c;return{setters:[function(e){t=e.cclegacy,o=e.Component,n=e.Label,s=e.Color,a=e.Vec3,i=e.tween,c=e._decorator}],execute:function(){var r;t._RF.push({},"c7578TlcTxIFLbBa7djsrCv","Damage",void 0);const{ccclass:d,property:l}=c;e("Damage",d("Damage")(r=class extends o{setDamage(e,t){let o=this.node.getChildByName("text").getComponent(n);o.string=e,o.color=1==t?s.YELLOW:2==t?s.RED:3==t?new s(255,0,255):4==t?s.GREEN:s.WHITE;let c=new a(this.node.position.x,this.node.position.y+80,this.node.position.z);i(this.node).to(.5,{position:c},{easing:"quadIn"}).call((()=>{this.node.destroy()})).start()}})||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/DrawSquare.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,o,n,s,a,c,l,p,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty},function(e){i=e.cclegacy,o=e.SpriteFrame,n=e.CCInteger,s=e._decorator,a=e.Component,c=e.Node,l=e.Vec3,p=e.Sprite,h=e.UITransform}],execute:function(){var u,S,b,d,f,m,w;i._RF.push({},"0e00b9Kb7xPSIwNujaMW0c1","DrawSquare",void 0);const{ccclass:k,property:g}=s;e("DrawSquare",(u=k("DrawSquare"),S=g(o),b=g(n),u((m=t((f=class extends a{constructor(){super(...arguments),r(this,"blockSpriteFrame",m,this),r(this,"blockSize",w,this),this.shapes=[[[1]],[[1],[1]],[[1],[1],[1]],[[1,1]],[[0,1],[1,1]],[[1,1],[1,1]],[[1,1],[0,1]],[[1,0],[1,1]]]}drawShapeByIndex(e){if(e<0||e>=this.shapes.length)return void console.error("Invalid shape index");const t=this.shapes[e];this.clearPreviousShapes(),this.drawShape(t,0,0)}clearPreviousShapes(){this.node.removeAllChildren()}drawShape(e,t,r){for(let i=0;i<e.length;i++)for(let o=0;o<e[i].length;o++)if(1===e[i][o]){const e=t+o*this.blockSize,n=r-i*this.blockSize,s=new c("Block");s.setParent(this.node),s.setPosition(new l(e,n,0));s.addComponent(p).spriteFrame=this.blockSpriteFrame;const a=s.getComponent(h);a&&a.setContentSize(this.blockSize,this.blockSize)}}}).prototype,"blockSpriteFrame",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(f.prototype,"blockSize",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),d=f))||d));i._RF.pop()}}}));

System.register("chunks:///_virtual/FadeoutEffect.ts",["cc","./NodePoolMap.ts","./GameConfig.ts"],(function(t){var o,e,i,s,n,c,a,u;return{setters:[function(t){o=t.cclegacy,e=t.Component,i=t.UIOpacity,s=t.tween,n=t.v3,c=t._decorator},function(t){a=t.default},function(t){u=t.NodePoolName}],execute:function(){var r;o._RF.push({},"6e975Z0opZDx7rXuDz3LqYq","FadeoutEffect",void 0);const{ccclass:p,property:d}=c;t("FadeoutEffect",p("FadeoutEffect")(r=class extends e{constructor(){super(...arguments),this.uiopacity=null}onLoad(){this.uiopacity=this.node.getComponent(i)}startAnim(){s(this.node).to(.5,{position:n(this.node.getPosition().x,this.node.getPosition().y+75,0)}).start(),s(this.uiopacity).to(.5,{opacity:0}).call((()=>{this.backToPool()})).start()}backToPool(){this.node.removeFromParent(),this.uiopacity.opacity=255,this.node.setPosition(0,0,0),a.put(u.DeathEffect,this.node)}update(t){}})||r);o._RF.pop()}}}));

System.register("chunks:///_virtual/fightManager.ts",["cc","./SpriteManager.ts","./PrefabManager.ts","./homeBottom.ts","./Utils.ts","./Global.ts","./ToastManager.ts","./successAlert.ts","./AudioManager.ts","./httpService.ts"],(function(t){var e,n,i,a,s,o,c,r,h,l,d,g,u,m,p,C,f,I,b,v,B,T,y;return{setters:[function(t){e=t.cclegacy,n=t.Component,i=t.find,a=t.Label,s=t.instantiate,o=t.Node,c=t.Sprite,r=t.Vec3,h=t.Widget,l=t.Button,d=t.TweenSystem,g=t.tween,u=t.director,m=t._decorator},function(t){p=t.SpriteManager},function(t){C=t.PrefabManager},function(t){f=t.homeBottom},function(t){I=t.default},function(t){b=t.Global},function(t){v=t.ToastManager},function(t){B=t.successAlert},function(t){T=t.AudioManager},function(t){y=t.default}],execute:function(){var N;e._RF.push({},"ebf56rbveZMX6YQuk3Zk+bG","fightManager",void 0);const{ccclass:x,property:w}=m;t("fightManager",x("fightManager")(N=class extends n{constructor(){super(...arguments),this.tabs=[],this.leftButtonNode=null,this.rightButtonNode=null,this.moveDistance=1100,this.moveDuration=.5,this.currentTabIndex=0,this.currentChapterID=0,this.titleComp=null,this.tipsComp=null,this.leftRightCanClick=!0,this.awardData={},this.startBtnNode=null,this.signAlertNode=null,this.alertContainer=null,this.loadingContainer=null,this.httpService=void 0}async onLoad(){this.httpService=new y,this.titleComp=i("content/title",this.node).getComponent(a),this.tipsComp=i("content/tips",this.node).getComponent(a),this.leftButtonNode=i("content/scroll/left",this.node),this.rightButtonNode=i("content/scroll/right",this.node),this.startBtnNode=i("content/buttons/start",this.node),this.signAlertNode=this.node.getChildByName("signAlert"),this.alertContainer=this.node.getChildByName("alert"),this.loadingContainer=this.node.getChildByName("loading");let t=s(C.getInstance().get("loading"));this.loadingContainer.addChild(t),this.loadingContainer.active=!1,t=s(C.getInstance().get("alert")),this.alertContainer.addChild(t),this.alertContainer.active=!1,this.leftButtonNode&&this.leftButtonNode.on("click",this.previousTab,this),this.rightButtonNode&&this.rightButtonNode.on("click",this.nextTab,this),this.initData(),this.awardData=await this.fetchData()}start(){let t=s(C.getInstance().get("bottom"));t.getComponent(f).init(2),this.node.getChildByName("bottom").addChild(t),t=s(C.getInstance().get("header")),this.node.getChildByName("header").addChild(t)}initData(){this.startBtnNode.getChildByName("cost").getComponent(a).string="x"+b.Instance.getConfig("startGamePrice"),this.node.getChildByPath("content/signIn").active=b.Instance.get("chapterID")>0,this.loadTabs(),this.createSignItems()}async fetchData(){try{const t=await this.httpService.postDataToService("fight/game_levels/getObtainBox",{});return I.isEmpty(t.code)?t:void v.show(t.msg,2)}catch(t){return console.error("Failed to fetch data:",t),null}}onDestroy(){b.Instance.clearCache("fightSceneData")}loadTabs(){const t=b.Instance.chapterData,e=Object.values(t);let n=b.Instance.get("chapterID");this.currentChapterID=n,this.currentTabIndex=n,0==this.currentTabIndex?this.leftButtonNode.active=!1:this.leftButtonNode.active=!0;let a=n+3,s=e.slice(0,a);const l=i("content/scroll/tabs",this.node);let d=0;s.forEach((t=>{let e="fight-bg-"+t.pic,i=new o;i.addComponent(c).spriteFrame=p.getInstance().get(e),i.setPosition(new r(d===this.currentTabIndex?0:this.moveDistance,0,0)),i.active=d===this.currentTabIndex,i.parent=l,d===this.currentTabIndex&&(this.titleComp.string=t.id+". "+t.name),n>t.id?this.tipsComp.string="Passed":this.tipsComp.string="Let's gooooooooo!";let a=i.addComponent(h);a.isAlignTop=!0,a.isAlignBottom=!0,a.isAlignLeft=!0,a.isAlignRight=!0,a.top=0,a.bottom=0,a.left=0,a.right=0,this.tabs.push(i),d++})),this.checkAwardBox()}createSignItems(){let t=b.Instance.get("signDay");const e=i("content/items",this.signAlertNode);e.removeAllChildren();const n=t+1,o=b.Instance.get("lastSignTime");let c=!1;for(let i=1;i<10;i++){const r=s(C.getInstance().get("signItem"));let h=i;r.getChildByName("title").getComponent(a).string="Day "+h,h<=t&&(r.getChildByName("tips").active=!0);const d=Math.floor(Date.now()/1e3);h==n&&d-o>86400?(r.on(l.EventType.CLICK,(()=>this.doSignClick(h)),this),c=!0):(r.on(l.EventType.CLICK,(()=>{v.show("can not sign",2)}),this),r.getChildByName("num").getComponent(a).string=""),e.addChild(r)}if(c){const t=this.node.getChildByPath("content/signIn");I.startRotation(t,.3,10)}}checkAwardBox(){const t=b.Instance.get("chapterID");let e=this.awardData[this.currentTabIndex+1];e||(e="5,0;10,0;20,0"),e.split(";").forEach((e=>{let n=e.split(","),a=n[0],s=parseInt(n[1]);const o=i("content/boxs/content/box/box-"+a,this.node);d.instance.ActionManager.removeAllActionsFromTarget(o),o.eulerAngles=new r(0,0,0);let h="award-box-close";o.getChildByName("flag").active=!1,t>this.currentTabIndex&&(1==s?h="award-box-open":(I.startRotation(o,.3,10),o.getChildByName("flag").active=!0)),o.getComponent(c).spriteFrame=p.getInstance().get(h)}))}updateTabVisibility(){const t=b.Instance.chapterData,e=Object.values(t);let n=b.Instance.get("chapterID");for(let t=0;t<this.tabs.length;t++)if(this.tabs[t].active=t===this.currentTabIndex,t===this.currentTabIndex){let a=e[t];this.titleComp.string=a.id+". "+a.name;const s=i("content/buttons",this.node),o=i("content/unlockTip",this.node);let c="Let's gooooooooo!";if(n>=a.id)c="Passed",s.active=!0,o.active=!1;else{const t=n+1==a.id;s.active=t,o.active=!t}this.tipsComp.string=c}}moveTab(t,e,n){let i=t.position.clone(),a=new r(i.x+n*this.moveDistance,i.y,i.z),s=new r(-n*this.moveDistance,i.y,i.z);e.setPosition(s),e.active=!0,g(t).to(this.moveDuration,{position:a}).start(),g(e).to(this.moveDuration,{position:i}).call((()=>{this.updateTabVisibility(),this.checkAwardBox(),this.leftRightCanClick=!0})).start()}previousTab(){if(this.leftRightCanClick){if(T.getInstance().playSnd("clickBtn"),this.leftRightCanClick=!1,this.currentTabIndex>0){let t=this.tabs[this.currentTabIndex],e=this.tabs[this.currentTabIndex-1];this.currentTabIndex--,this.moveTab(t,e,1)}else this.leftRightCanClick=!0;0==this.currentTabIndex?this.leftButtonNode.active=!1:this.leftButtonNode.active=!0,this.rightButtonNode.active=!0}}nextTab(){if(this.leftRightCanClick){if(T.getInstance().playSnd("clickBtn"),this.leftRightCanClick=!1,this.currentTabIndex<this.tabs.length-1){let t=this.tabs[this.currentTabIndex],e=this.tabs[this.currentTabIndex+1];this.currentTabIndex++,this.moveTab(t,e,-1)}else this.leftRightCanClick=!0;this.currentTabIndex==this.tabs.length-1?this.rightButtonNode.active=!1:this.rightButtonNode.active=!0,this.leftButtonNode.active=!0}}async onBoxClick(t,e){T.getInstance().playSnd("clickBtn");const n=t.currentTarget.getComponent(l);if(n.interactable=!1,this.currentChapterID<=this.currentTabIndex)return v.show("Claim after clearing",2),void this.scheduleOnce((()=>{n.interactable=!0}),1);const i=this.currentTabIndex+1;let a=this.awardData[i];a||(console.log("currentAwardInfo数据不存在"),a="5,0;10,0;20,0");let s=a.split(";"),o=0;if(s.forEach((t=>{let n=t.split(",");n[0]==e&&(o=parseInt(n[1]))})),o)return v.show("Already claimed",2),void this.scheduleOnce((()=>{n.interactable=!0}),1);this.openLoading();const c=await this.httpService.postDataToService("fight/game_levels/rewardBox",{level_id:i,award_box_number:e});if(this.closeLoading(),!I.isEmpty(c.code))return v.show(c.msg,2),void this.scheduleOnce((()=>{n.interactable=!0}),1);const r=this.alertContainer.getChildByName("alert");let h=[];const d=parseInt(c.newGoldAmount),g=parseInt(c.newDiamondAmount);d&&(b.Instance.updateGolds(d),h.push({iconFrameName:"golds",num:d})),g&&(b.Instance.updateDiamonds(g),h.push({iconFrameName:"diamonds",num:g}));const u=c.allocatedFragments;if(!I.isEmpty(u))for(const t in u){const e=u[t];h.push({fruitId:t,iconFrameName:t+"-1",num:e,needScale:!0})}r.getComponent(B).updateItems(h),this.alertContainer.active=!0,r.active=!0,this.awardData=await this.fetchData(),this.checkAwardBox(),this.scheduleOnce((()=>{n.interactable=!0}),1)}async onStartBtnClick(){T.getInstance().playSnd("clickBtn");const t=this.startBtnNode.getComponent(l);t.interactable=!1;let e=b.Instance.get("golds"),n=b.Instance.getConfig("startGamePrice");if(e<n)v.show("Out of Golds",2);else{b.Instance.updateGolds(-n);const t=this.currentTabIndex+1;this.openLoading();const e=await this.httpService.postDataToService("fight/game/startGame",{level_id:t});this.closeLoading(),I.isEmpty(e.code)?(b.Instance.fightLevelId=t,u.loadScene("game")):v.show(e.msg,2)}this.scheduleOnce((()=>{t.interactable=!0}),1)}onSignBtnClick(t,e){T.getInstance().playSnd("clickBtn");const n=t.currentTarget.getComponent(l);n.interactable=!1;this.node.getChildByName("signAlert").active=!0,n.interactable=!0}async doSignClick(t){this.openLoading();const e=await this.httpService.postDataToService("fight/daySignIn",{});if(this.closeLoading(),!I.isEmpty(e.code))return void v.show(e.msg,2);const n=e.rewardDiamond;let i=[];n&&(i.push({iconFrameName:"diamonds",num:n}),b.Instance.updateDiamonds(n));const a=e.rewardGold;a&&(i.push({iconFrameName:"golds",num:a}),b.Instance.updateGolds(a));const s=this.alertContainer.getChildByName("alert");s.getComponent(B).updateItems(i),this.alertContainer.active=!0,s.active=!0,b.Instance.set("signDay",e.signDay),b.Instance.set("lastSignTime",e.signTime),this.createSignItems()}onSignAlertCloseBtnClick(){T.getInstance().playSnd("clickBtn"),this.signAlertNode.active=!1}openLoading(){this.loadingContainer.active=!0}closeLoading(){this.loadingContainer.active=!1}})||N);e._RF.pop()}}}));

System.register("chunks:///_virtual/Fruit.ts",["cc","./GameObj.ts","./TDGame.ts","./Monster.ts","./GameScene.ts","./NodePoolMap.ts","./GameConfig.ts","./Bullet.ts","./AudioManager.ts","./Pack.ts","./FruitManager.ts","./SpriteManager.ts","./Global.ts","./Buff.ts"],(function(t){var e,s,i,a,r,n,l,h,c,o,d,g,u,f,p,m,k,v,S,G,I,T;return{setters:[function(t){e=t.cclegacy,s=t.Animation,i=t.Sprite,a=t.v3,r=t.tween,n=t.UITransform,l=t.Vec3,h=t._decorator},function(t){c=t.GameObj},function(t){o=t.TDGame,d=t.GameState},function(t){g=t.Monster},function(t){u=t.GameScene},function(t){f=t.default},function(t){p=t.NodePoolName},function(t){m=t.Bullet},function(t){k=t.AudioManager},function(t){v=t.Pack},function(t){S=t.FruitManager},function(t){G=t.SpriteManager},function(t){I=t.Global},function(t){T=t.Buff}],execute:function(){var A;e._RF.push({},"55aeeHDQsVKMLxVqZOaZ/ON","Fruit",void 0);const{ccclass:F,property:B}=h;t("Fruit",F("Fruit")(A=class t extends c{constructor(){super(...arguments),this.atkSpeed=1,this.critDamageMultiplier=1.8,this.critRate=0,this.damage=0,this.timeTick=0,this.anim=null,this.fillGrids=[],this.levelSprite=null,this.sprite=null,this.specBuff={},this.stackedAtkSpeed=!1,this.maxStacks=5,this.attackSpeedStacks=0,this.attackSpeedIncreasePercentage=0,this.targetSelect=1,this._attackTargets=[],this.fruitId=0,this._level=1}setFruitId(t){if(t<0)return;const e=I.Instance.getUserFruitById(t);this.fruitId=t;const s=e.atk_speed/10;this.atkSpeed=s,this.damage=e.attack,this.critRate=e.baojilv/100,T.getInstance().newFruitApplyBuffs(this)}setFruitBasicBuff(t,e,s,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===s&&(s=0),void 0===i&&(i=0),e&&(this.atkSpeed=e),t&&(this.damage=t),s&&(this.critRate=s),i&&(this.critDamageMultiplier=i)}setStackedAtkSpeed(t,e){this.stackedAtkSpeed=!0,this.maxStacks=t,this.attackSpeedIncreasePercentage=e}setSpecBuff(t,e,s,i){if(i){let s=0;if(12==t?s=11:17==t&&(s=16),this.specBuff[s]){const t=this.specBuff[s].value;this.specBuff[s].value=t*(1+e/100)}}else 18==t||19==t?this.targetSelect=e:this.specBuff[t]={type:t,value:e,time:s}}getFruitId(){return this.fruitId}set level(t){this.init(),this._level=t,this.damage*=2;let e="lv"+this._level;this.levelSprite.spriteFrame=G.getInstance().get(e);let s=this.fruitId+"-"+this._level;this.sprite.spriteFrame=G.getInstance().get(s)}customInit(){this.anim=this.node.getChildByName("sprite").getComponent(s),this.levelSprite=this.node.getChildByName("level").getComponent(i),this.sprite=this.node.getChildByName("sprite").getComponent(i)}start(){}getLevel(){return this._level}onAddPack(){super.onAddPack(),this.fillGrids.splice(0,this.fillGrids.length);for(let t=0;t<this.coverGrids.length;t++)this.fillGrids.push(this.coverGrids[t])}onRemoveFromPack(){super.onRemoveFromPack();for(let t=0;t<this.fillGrids.length;t++)this.fillGrids[t].setGameObj(null);this.fillGrids.splice(0,this.fillGrids.length)}moveToCoverGrids(){super.moveToCoverGrids();for(let t=0;t<this.fillGrids.length;t++)this.fillGrids[t].setGameObj(null);this.fillGrids.splice(0,this.fillGrids.length);for(let t=0;t<this.coverGrids.length;t++)this.fillGrids.push(this.coverGrids[t]),this.coverGrids[t].setGameObj(this)}backToFillGrids(){super.backToFillGrids(),this.coverGrids.splice(0,this.coverGrids.length);for(let t=0;t<this.fillGrids.length;t++)this.coverGrids.push(this.fillGrids[t]);this.centerOnCoverGrids()}merge(e){if(this.getLevel()>=4)return!1;let s=e.getComponent(t);for(let t=0;t<s.fillGrids.length;t++)s.fillGrids[t].setGameObj(null);e.node.removeFromParent(),e.node.destroy();let i=a(1,1,1);this.node.parent===S.getInstance().attachNode&&i.set(this._scale,this._scale,1),r(this.node).to(.2,{scale:a(1.5,1.5,1)}).to(.2,{scale:i}).union().start(),this.level=this.getLevel()+1,k.getInstance().playSnd("bagHecheng"),console.log("merge down")}tryMerge(t){if(!t)return!1;if(this.getLevel()>=4)return!1;if(t!==this&&t.getFruitId()===this.getFruitId()&&t.getLevel()===this.getLevel()){let e=a(0,0,0),s=t.node.getPosition();if(t.node.parent===v.getInstance().attachNode){let e=t.node.getComponent(n).convertToWorldSpaceAR(l.ZERO);s=S.getInstance().attachNode.getComponent(n).convertToNodeSpaceAR(e)}return l.subtract(e,this.node.getPosition(),s),e.length()<=50&&(this.merge(t),!0)}return!1}tryAttack(t){this.timeTick+=t,this._attackTargets.length<=0&&this.getAttackTarget(),this._attackTargets.length>0&&this.timeTick>=this.atkSpeed&&(this.stackedAtkSpeed&&this.attackSpeedStacks<this.maxStacks&&(this.attackSpeedStacks++,this.updateAttackSpeed(),console.log(`攻击！当前攻速: ${this.atkSpeed.toFixed(2)}，叠加层数: ${this.attackSpeedStacks}`)),this._attackTargets.forEach((t=>this.shoot(t))))}updateAttackSpeed(){this.atkSpeed=this.atkSpeed*(1-this.attackSpeedIncreasePercentage*this.attackSpeedStacks/100)}shoot(t){let e=f.get(p.Bullet).getComponent(m);e.setShooterAndTarget(this,t),u.getInstance().addBullet(e),this.anim.play(),this.timeTick=0,this.clearAttackTarget()}clearAttackTarget(){this._attackTargets=[]}getAttackTarget(){if(this.damage<=0)return;let t=-1,e=[];if(1001==this.fruitId)e=this.getAttackTargetRandom();else{let s=null,i=null;for(let e=0;e<u.getInstance().monsterAttachNode.children.length;e++){let a=u.getInstance().monsterAttachNode.children[e].getComponent(g);if(a.isDeath||a.isExpectDeath())continue;a.isBoss&&(i=a);let r=a.getMoveProcess();r>t&&(t=r,s=a)}if(1010==this.fruitId&&i&&(s=i),s){if(1012==this.fruitId){const t=.95*s.movSpeed;s.setDeBuff(t)}e.push(s)}}if(1005==this.fruitId&&this.targetSelect>1){const t=this.getAttackTargetRandom();e.push(...t)}return this._attackTargets=e,this._attackTargets.length>0&&this._attackTargets.forEach((t=>t.addAttacker(this))),null}getAttackTargetRandom(){let t=[];const e=u.getInstance().monsterAttachNode.children.map((t=>t.getComponent(g))).filter((t=>!t.isDeath&&!t.isExpectDeath()));if(e.length>0){const s=[];let i=this.targetSelect;for(i>e.length&&(i=e.length);s.length<i;){const i=Math.floor(Math.random()*e.length);s.includes(i)||(s.push(i),t.push(e[i]))}}return t}update(t){o.getInstance().gameState===d.gameing&&this.tryAttack(t)}})||A);e._RF.pop()}}}));

System.register("chunks:///_virtual/FruitManager.ts",["cc","./PrefabManager.ts","./MathUtil.ts","./GameConfig.ts","./GameObj.ts","./Platform.ts","./Fruit.ts","./AudioManager.ts","./Global.ts"],(function(t){var e,a,n,i,s,o,r,h,l,d,c,u,g;return{setters:[function(t){e=t.cclegacy,a=t._decorator,n=t.Component,i=t.instantiate},function(t){s=t.PrefabManager},function(t){o=t.default},function(t){r=t.GridPrefabs},function(t){h=t.GameObj,l=t.GameObjType},function(t){d=t.Platform},function(t){c=t.Fruit},function(t){u=t.AudioManager},function(t){g=t.Global}],execute:function(){var m,b;e._RF.push({},"7d221gSbbJKsal0T4Fk/lDj","FruitManager",void 0);const{ccclass:p,property:O}=a;t("FruitManager",p("FruitManager")(((b=class t extends n{constructor(){super(...arguments),this.attachNode=null,this.bgSpriteNode=null,this.extraLv2Fruit=!1}static getInstance(){return t.instance}onLoad(){t.instance=this,this.attachNode=this.node.getChildByName("attach"),this.bgSpriteNode=this.node.getChildByName("bg")}start(){}spawnGameObjs(t){void 0===t&&(t=!1),u.getInstance().playSnd("点击按钮"),this.spawnGameObjsOnlyFruit(t),this.extraLv2Fruit&&(this.spawnGameObjsOnlyFruit(!0),this.extraLv2Fruit=!1),Math.random()<.15?this.spawnGameObjsOnlyGrid():this.spawnGameObjsOnlyFruit(!1),Math.random()<.15?this.spawnGameObjsOnlyGrid():this.spawnGameObjsOnlyFruit(!1),this.updateObjsPosition()}spawnGameObjsOnlyGrid(){let t=o.randRangeNumber(0,r.length-1),e=i(s.getInstance().get(r[t])).getComponent(h);this.addGameObj(e),this.updateObjsPosition()}spawnGameObjsOnlyFruit(e){void 0===e&&(e=!1);const a=g.Instance.getAllUserFruit(),n=Object.keys(a);let r=n[o.randRangeNumber(0,n.length-1)],l=i(s.getInstance().get(r)),d=l.getComponent(h);if(d.scale=t.objScale,l.getComponent(c).setFruitId(r),e)l.getComponent(c).level=2;else{const t=Math.random();l.getComponent(c).level=t<.05?3:t<.1?2:1}this.addGameObj(d)}clear(){this.attachNode.destroyAllChildren(),this.attachNode.removeAllChildren()}refreshGameObjs(t){void 0===t&&(t=!1),this.attachNode.destroyAllChildren(),this.attachNode.removeAllChildren(),this.spawnGameObjs(t)}addGameObj(t){this.attachNode.addChild(t.node),t.canDrag=!0}removeGameObj(t){t&&(t.node.removeFromParent(),this.updateObjsPosition())}hideFruits(){for(let t=0;t<this.attachNode.children.length;t++){this.attachNode.children[t].getComponent(h).objType===l.Fruit&&(this.attachNode.children[t].active=!1)}}showAll(){this.show(!0);for(let t=0;t<this.attachNode.children.length;t++)this.attachNode.children[t].active=!0}show(t){this.bgSpriteNode.active=t,this.attachNode.active=t}updateObjsPosition(){let e=this.attachNode.children.length,a=220*t.objScale,n=e*a,i=(d.getInstance().designSize.x-n)/(e+1),s=-.5*(n+(e-1)*i)+.5*a;for(let t=0;t<this.attachNode.children.length;t++){this.attachNode.children[t].getComponent(h).changeTweenPos(s+t*i+t*a,0)}}tryMerge(e){if(e.objType!==l.Fruit)return!1;let a=e.getComponent(c),n=null;for(let e=0;e<this.attachNode.children.length;e++){if(this.attachNode.children[e].getComponent(h).objType!==l.Fruit)continue;if(n=this.attachNode.children[e].getComponent(c),n.tryMerge(a))return t.getInstance().updateObjsPosition(),!0}return!1}update(t){}}).objScale=1.3,b.instance=null,m=b))||m);e._RF.pop()}}}));

System.register("chunks:///_virtual/GameApp.ts",["cc","./BaseApp.ts","./Utils.ts"],(function(t){var a,e,s,n;return{setters:[function(t){a=t.cclegacy,e=t._decorator},function(t){s=t.BaseApp},function(t){n=t.default}],execute:function(){var o;a._RF.push({},"2caa9ZBoyJBb5WpyQ57JRqB","GameApp",void 0);const{ccclass:i,property:p}=e;t("GameApp",i("GameApp")(o=class extends s{constructor(){super(...arguments),this.gameLoading=null}onLoad(){super.onLoad(),this.init()}start(){super.start(),this.gameLoading.startLoading("shop")}init(){let t=n.getNodeFromCanvas("loading");this.gameLoading=t.getComponent("Loading")}})||o);a._RF.pop()}}}));

System.register("chunks:///_virtual/GameConfig.ts",["cc"],(function(e){var t;return{setters:[function(e){t=e.cclegacy}],execute:function(){t._RF.push({},"cda6dFRlwVLSo76PTOoPNfl","GameConfig",void 0);e("UIPrefab",{}),e("ResPath",{bgmPath:"/bgm",sndPath:"/snd",prefabPath:["/game","/home"]}),e("SpritesDir",["/fruits","/monster","/lv-number","/buff","/home"]),e("NodePoolName",{Monster:"Monster",Bullet:"Bullet",DeathEffect:"DeathEffect"}),e("GridPrefabs",["grid0","grid1","grid2"]);t._RF.pop()}}}));

System.register("chunks:///_virtual/GameLevel.ts",["cc","./PrefabManager.ts","./GameScene.ts","./Monster.ts","./MainUI.ts","./TDGame.ts","./FruitManager.ts","./Global.ts"],(function(e){var t,a,n,s,i,r,o,h,c,v,l,u;return{setters:[function(e){t=e.cclegacy,a=e.Component,n=e.instantiate,s=e._decorator},function(e){i=e.PrefabManager},function(e){r=e.GameScene},function(e){o=e.Monster},function(e){h=e.MainUI},function(e){c=e.TDGame,v=e.GameState},function(e){l=e.FruitManager},function(e){u=e.Global}],execute:function(){var m;t._RF.push({},"8b032ZGjnNAa6qK8PBBfcGb","GameLevel",void 0);const{ccclass:g,property:w}=s;e("GameLevel",g("GameLevel")(m=class extends a{constructor(){super(...arguments),this.waveCfg=null,this.levelAddSliver=0,this._wave=-1,this._nextWaveTime=1,this.waveTime=0,this.waveData=[],this.currentMonsterIndex=0,this.currentMonsterCount=0,this.monsterSpawnTimer=0}get wave(){return this._wave}set wave(e){this._wave=e,r.getInstance().updateWaveLabel(this.waveCfg.length)}get nextWaveTime(){return this._nextWaveTime}set nextWaveTime(e){this._nextWaveTime=e}onLoad(){this.currentMonsterIndex=0,this.currentMonsterCount=0,this.monsterSpawnTimer=0,this.waveCfg=u.Instance.getFightWavesInfo()}start(){}reset(){this.wave=-1,this.waveTime=0,this.waveData.splice(0,this.waveData.length)}parseMonsterData(e){return e.split(";").map((e=>{const[t,a,n]=e.split(",").map(Number);return{id:t,count:a,interval:n}}))}startNextWave(){this.wave++,this.waveTime=0,this.waveData.splice(0,this.waveData.length),this.waveData=this.parseMonsterData(this.waveCfg[this.wave].monster_id);let e=!1;for(let t=0;t<this.waveData.length;t++)this.waveData[t].active=!1,this.waveData[t].blood_multiply=this.waveCfg[this.wave].blood_multiply,this.waveCfg[this.wave].is_boss&&(e=!0);e&&h.getInstance().showBossComeingUI()}beforeStartNextWave(){if(this.wave+1>=this.waveCfg.length)h.getInstance().showVictoryUI(!0),c.getInstance().gameState=v.gameover;else{const e=parseInt(u.Instance.getConfig("winSliverPerWave"));c.getInstance().addSilver(e+this.levelAddSliver),h.getInstance().updateSilverNum(),c.getInstance().enterFillPackMode(),l.getInstance().refreshGameObjs(),this.currentMonsterIndex=0,this.currentMonsterCount=0,this.monsterSpawnTimer=0}}spawnMonster(e,t){let a=n(i.getInstance().get("monster")).getComponent(o);a.setMonsterId(e,t),r.getInstance().addMonster(a)}generateRandomNumber(){const e=Math.floor(15)+1;return.5+.3*Math.floor(Math.random()*e)}update(e){if(this.waveData.length<=0||c.getInstance().gameState!==v.gameing)return;if(this.waveTime+=e,this.currentMonsterIndex<this.waveData.length){const t=this.waveData[this.currentMonsterIndex];if(this.currentMonsterCount<t.count){this.monsterSpawnTimer+=e;const a=this.generateRandomNumber();this.monsterSpawnTimer>=a&&(this.monsterSpawnTimer=0,this.spawnMonster(t.id,t.blood_multiply),this.currentMonsterCount++,this.waveData[this.currentMonsterIndex].active=!0)}else this.currentMonsterIndex++,this.currentMonsterCount=0,this.monsterSpawnTimer=0}let t=!0;for(let e=0;e<this.waveData.length;e++)if(void 0===this.waveData[e].active||!this.waveData[e].active){t=!1;break}t&&0===r.getInstance().monsterAttachNode.children.length&&this.beforeStartNextWave()}})||m);t._RF.pop()}}}));

System.register("chunks:///_virtual/GameObj.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameScene.ts","./Pack.ts","./FruitManager.ts","./TDGame.ts","./AudioManager.ts"],(function(t){var e,i,n,s,o,r,a,h,c,g,d,l,u,p,v,T,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,s=t.Enum,o=t.CCInteger,r=t._decorator,a=t.Component,h=t.v3,c=t.UITransform,g=t.Node,d=t.Vec3,l=t.tween},function(t){u=t.GameScene},function(t){p=t.Pack},function(t){v=t.FruitManager},function(t){T=t.TDGame},function(t){f=t.AudioManager}],execute:function(){var G,O,y,b,m,D,C,E,j,I;n._RF.push({},"ea318FpIFZAf4qCiYyRG7wo","GameObj",void 0);const{ccclass:P,property:S}=r;let N=t("GameObjType",function(t){return t[t.None=0]="None",t[t.Fruit=1]="Fruit",t[t.Grid=2]="Grid",t}({}));t("GameObj",(G=P("GameObj"),O=S({type:s(N)}),y=S({type:o}),b=S({type:o}),G(((I=class t extends a{constructor(){super(...arguments),i(this,"objType",C,this),i(this,"width",E,this),i(this,"height",j,this),this.uiTrans=null,this.inited=!1,this._scale=1,this.dragingPos=h(0,0,0),this.isDraging=!1,this.coverGrids=[],this.posBeforeDraing=h(0,0,0),this._canDrag=!1,this.gridsParent=null}set scale(t){this._scale=t,this.node.setScale(t,t,1)}set draging(t){this.isDraging=t}get draging(){return this.isDraging}set canDrag(t){this._canDrag=t}get canDrag(){return this._canDrag}static setDragingObj(e){t.dragingObj=e}static getDragingObj(){return t.dragingObj}onLoad(){this.init()}start(){}onDestroy(){this.removeEventListener()}init(){this.inited||(this.uiTrans=this.node.getComponent(c),this.uiTrans.setContentSize(this.width,this.height),this.gridsParent=this.node.getChildByName("grids"),this.customInit(),this.addEventListener(),this.inited=!0)}customInit(){}addEventListener(){this.node.on(g.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(g.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(g.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(g.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}removeEventListener(){this.node.off(g.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(g.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(g.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(g.EventType.TOUCH_CANCEL,this.onTouchCancel,this)}onTouchStart(t){console.log("开始移动水果"),f.getInstance().playSnd("点击水果"),this.node.parent!==p.getInstance().attachNode&&this.node.setScale(u.editModeScale.x,u.editModeScale.x,1)}onTouchMove(t){if(this.canDrag&&(!this.draging&&t.touch.getDelta().lengthSqr()>10&&this.startDraging(),this.draging)){this.dragingPos.set(t.touch.getUILocation().x,t.touch.getUILocation().y,0);let e=this.node.parent.getComponent(c);this.dragingPos=e.convertToNodeSpaceAR(this.dragingPos),this.node.setPosition(this.dragingPos),p.getInstance().updateByDragingObj(this)}}onTouchEnd(t){this.scale=this._scale,this.draging?this.endDraging():this.node.parent===p.getInstance().attachNode&&this.node.setScale(d.ONE)}onTouchCancel(t){this.scale=this._scale,this.draging?this.endDraging():this.node.parent===p.getInstance().attachNode&&this.node.setScale(d.ONE)}getLevel(){return 0}startDraging(){this.draging=!0,this.posBeforeDraing.set(this.node.getPosition()),t.setDragingObj(this),this.objType===N.Grid&&T.getInstance().enterEditPackMode()}endDraging(){if(this.draging=!1,p.getInstance().updateByDragingObj(null),t.setDragingObj(null),this.coverGrids.length===this.gridsParent.children.length)p.getInstance().addGameObj(this);else if(this.node.parent===v.getInstance().attachNode){v.getInstance().tryMerge(this)||(this.clearCoverGrids(),this.changeTweenPos(this.posBeforeDraing.x,this.posBeforeDraing.y))}else if(this.node.parent===p.getInstance().attachNode){v.getInstance().tryMerge(this)?p.getInstance().removeGameObj(this):(p.getInstance().removeGameObj(this),v.getInstance().addGameObj(this),v.getInstance().updateObjsPosition())}}onAddPack(){f.getInstance().playSnd("移动水果到格子"),this.node.setScale(d.ONE),this.centerOnCoverGrids();for(let t=0;t<this.coverGrids.length;t++)this.coverGrids[t].setGameObj(this)}onRemoveFromPack(){this.node.removeFromParent();for(let t=0;t<this.coverGrids.length;t++)this.coverGrids[t].setGameObj(null)}moveToCoverGrids(){this.centerOnCoverGrids(),this.node.setScale(d.ONE)}backToFillGrids(){this.node.setScale(d.ONE)}centerOnCoverGrids(){let t=9999,e=-9999,i=9999,n=-9999;for(let s=0;s<this.coverGrids.length;s++){let o=this.coverGrids[s].node.getPosition();o.x<t&&(t=o.x),o.x>e&&(e=o.x),o.y<i&&(i=o.y),o.y>n&&(n=o.y)}this.node.setPosition(t+.5*(e-t),i+.5*(n-i),0)}addCoverGrid(t){if(t){for(let e=0;e<this.coverGrids.length;e++)if(t===this.coverGrids[e])return;this.coverGrids.push(t)}}clearCoverGrids(){this.coverGrids.splice(0,this.coverGrids.length)}changeTweenPos(t,e,i){void 0===i&&(i=.2),l(this.node).to(i,{position:h(t,e,0)},{easing:"backOut"}).call((()=>{})).start()}update(t){}}).dragingObj=null,C=e((D=I).prototype,"objType",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N.None}}),E=e(D.prototype,"width",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j=e(D.prototype,"height",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=D))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/GameScene.ts",["cc","./FruitManager.ts","./Utils.ts","./Monster.ts","./RuHua.ts","./Bullet.ts","./FadeoutEffect.ts","./TDGame.ts","./PrefabManager.ts","./SpriteManager.ts","./Global.ts"],(function(e){var t,n,o,a,i,s,l,h,r,d,c,g,u,m,p,N,f,b,C,v,y,B,A;return{setters:[function(e){t=e.cclegacy,n=e.v3,o=e._decorator,a=e.Component,i=e.Label,s=e.ProgressBar,l=e.tween,h=e.Vec3,r=e.UITransform,d=e.find,c=e.instantiate,g=e.Sprite},function(e){u=e.FruitManager},function(e){m=e.default},function(e){p=e.Monster},function(e){N=e.RuHua},function(e){f=e.Bullet},function(e){b=e.FadeoutEffect},function(e){C=e.TDGame,v=e.GameState},function(e){y=e.PrefabManager},function(e){B=e.SpriteManager},function(e){A=e.Global}],execute:function(){var S,P;t._RF.push({},"2f1d88QZdREtayknNRQtWKU","GameScene",void 0);const{ccclass:I,property:L}=o;e("GameScene",I("GameScene")(((P=class e extends a{constructor(){super(...arguments),this.pathSpriteNode=null,this.ruhua=null,this.monsterAttachNode=null,this.bulletAttachNode=null,this.effectAttachNode=null,this.bottomNode=null,this.headerNode=null,this.pathPoints=[],this.expProgress=null,this.levelLabel=null,this.waveLabel=null}static getInstance(){return e.instance}onLoad(){e.instance=this,this.pathSpriteNode=this.node.getChildByName("path");let t=this.node.getChildByName("gamePath");this.ruhua=t.getChildByName("ruhua").getComponent(N),this.monsterAttachNode=t.getChildByName("monster"),this.bulletAttachNode=t.getChildByName("bullet"),this.effectAttachNode=t.getChildByName("effect");let n=t.getChildByName("points");for(let e=0;e<n.children.length;e++)this.pathPoints.push(n.children[e].getPosition());this.headerNode=this.node.getChildByName("headerUI"),this.waveLabel=this.headerNode.getChildByName("waveLabel").getComponent(i),this.bottomNode=this.node.getChildByName("bottomUI"),this.expProgress=this.bottomNode.getChildByName("expProgress").getComponent(s),this.levelLabel=this.expProgress.node.getChildByName("lvLabel").getComponent(i)}enterFillPackMode(){this.pathSpriteNode.active=!1,this.pathSpriteNode.active=!1,this.bottomNode.active=!1,this.headerNode.active=!1,this.ruhua.node.active=!1,this.node.setScale(e.editModeScale)}enterEditPackMode(){u.getInstance().hideFruits()}async enterGame(){this.pathSpriteNode.active=!0,this.ruhua.node.active=!0,this.bottomNode.active=!0,this.headerNode.active=!0,l(this.node).to(.5,{scale:h.ONE}).start(),await m.sleep(600)}addMonster(e){this.monsterAttachNode.addChild(e.node),e.node.setSiblingIndex(0),e.node.setPosition(this.pathPoints[0]),e.init()}addBullet(e){let t=e.shooter.node.getComponent(r).convertToWorldSpaceAR(h.ZERO),n=this.bulletAttachNode.getComponent(r).convertToNodeSpaceAR(t);this.bulletAttachNode.addChild(e.node),e.node.setPosition(n)}addEffect(e,t){this.effectAttachNode.addChild(e),e.setPosition(t),e.getComponent(b).startAnim()}update(e){if(C.getInstance().gameState===v.gameing)for(let t=0;t<this.bulletAttachNode.children.length;t++){let n=this.bulletAttachNode.children[t].getComponent(f);!n.isDestroy&&n.inited&&n.moveToTarget(e)}}lateUpdate(e){let t=[];for(let e=0;e<this.monsterAttachNode.children.length;e++){let n=this.monsterAttachNode.children[e].getComponent(p);n.isDeath&&t.push(n)}for(let e=0;e<t.length;e++)t[e].destroyMonster();let n=[];for(let e=0;e<this.bulletAttachNode.children.length;e++){let t=this.bulletAttachNode.children[e].getComponent(f);t.isDestroy&&n.push(t)}for(let e=0;e<n.length;e++)n[e].backToPool()}reset(){let e=[];for(let t=0;t<this.monsterAttachNode.children.length;t++){let n=this.monsterAttachNode.children[t].getComponent(p);e.push(n)}for(let t=0;t<e.length;t++)e[t].destroyMonster();let t=[];for(let e=0;e<this.bulletAttachNode.children.length;e++){let n=this.bulletAttachNode.children[e].getComponent(f);t.push(n)}for(let e=0;e<t.length;e++)t[e].backToPool();this.ruhua.reset()}setExpProgress(e){this.expProgress.progress=e}updateLevelLabel(){this.levelLabel.string="Lv."+C.getInstance().level}addBuffToBottom(e,t){const n=d("buffContainer/view/content",this.bottomNode);let o=e+"-"+t,a=!0;for(let e=0;e<n.children.length;e++){const t=n.children[e];if(t.name==o){console.log("存在：",o);let e=t.getChildByName("num").getComponent(i);e.string=(parseInt(e.string)+1).toString(),a=!1}}if(a){let o=c(y.getInstance().get("selectBuff"));o.getChildByName("bg").getComponent(g).spriteFrame=B.getInstance().get(e+"-1"),o.getChildByName("icon").getComponent(g).spriteFrame=B.getInstance().get(t),o.name=e+"-"+t,n.addChild(o)}}addDamageRankToBottom(e){if(!m.isEmpty(e)){const t=d("buffContainer/view/content",this.bottomNode);t.removeAllChildren();const n=Object.entries(e).sort(((e,t)=>{let[,n]=e,[,o]=t;return Number(o)-Number(n)})).map((e=>{let[t,n]=e;return{key:Number(t),value:Number(n)}})),o=A.Instance.fruitNeedScaleX,a=A.Instance.fruitNeedScaleY;for(const e in Object.keys(n)){const s=n[e],l=s.key,r=s.value;let d=c(y.getInstance().get("rank")),u=new h(1,1,1);-1!=o.indexOf(l)&&(u.x=.5),-1!=a.indexOf(l)&&(u.y=.5),1010==l&&(u.x=.3);const p=d.getChildByName("icon");p.scale=u,p.getComponent(g).spriteFrame=B.getInstance().get(l+"-1"),d.getChildByName("damage").getComponent(i).string=m.formatNumber(r),t.addChild(d)}}}updateWaveLabel(e){this.waveLabel.string="Wave "+(C.getInstance().gameLevel.wave+1)+`/${e}`}}).editModeScale=n(1.5,1.5,1),P.instance=null,S=P))||S);t._RF.pop()}}}));

System.register("chunks:///_virtual/Global.ts",["cc","./Utils.ts","./httpService.ts","./index.ts"],(function(t){var e,s,i,o,n,a,r,c,h,d;return{setters:[function(t){e=t.cclegacy,s=t._decorator,i=t.Component,o=t.director},function(t){n=t.default},function(t){a=t.default},function(t){r=t.TonConnectUI,c=t.GameFi,h=t.Address,d=t.toNano}],execute:function(){var u,f;e._RF.push({},"b9878+TzTBLMYXEeqBv/RAC","Global",void 0);const{ccclass:l,property:g}=s;t("Global",l("Global")(((f=class t extends i{constructor(){super(...arguments),this.tgData=void 0,this.userInfo={},this.fruits={},this.fruitsBuff={},this.chapterData={},this.cache={},this.cacheExpiry={},this.cacheDuration=3e5,this.httpService=void 0,this.configs={},this.waves={},this.monster={},this.fruitTalents={},this.todayShop={},this.fruitLevels={},this.fightLevelId=void 0,this.fruitNeedScaleX=[1004,1010,1011,1012],this.fruitNeedScaleY=[1008],this._cocosGameFi=void 0,this._connectUI=void 0,this._tonAddressConfig={}}static get Instance(){return t._instance}onLoad(){t._instance=this,this.httpService=new a}async _initTonConnect(){let t=new r({manifestUrl:"https://eatme.fun/tonconnect-manifest.json"});this._tonAddressConfig={tonAddress:"UQCEADwc-GSmKAIASuJSaG0NtInpOebkVf_4-mm98b0Z5nxa",usdtAddress:"EQCxE6mUtQJKFnGfaROTKOt1lZbDiiX1kCixRv7Nw2Id_sDs"},this._cocosGameFi=await c.create({connector:t,network:"mainnet",merchant:{tonAddress:this._tonAddressConfig.tonAddress,jettonAddress:this._tonAddressConfig.usdtAddress}}),this._connectUI=this._cocosGameFi.walletConnector}isConnected(){return this._connectUI?this._connectUI.connected:(console.error("ton ui not inited!"),!1)}async sendTransfer(t){if(!this.isConnected())return this._connectUI.openModal(),{code:999};if(this._cocosGameFi&&this._cocosGameFi.walletConnector?.connected){const e=n.stringToHex(`tg_id:${t}`),s={jetton:h.parse(this._tonAddressConfig.usdtAddress),to:h.parse(this._tonAddressConfig.tonAddress),amount:d(2e-5),forwardAmount:d(1e-9),forwardPayload:e};try{const t=await this._cocosGameFi.transferJetton(s);return console.log("result"),console.log(t),{code:0,msg:"Request added to the queue for execution, please wait"}}catch(t){return console.log(t.message),{code:1,msg:t.message}}}}async bindUserInviteCode(t){const e=atob(t);this.httpService.postDataToService("user/bindInviteCode",{invite_code:e})}async fetchGlobalDataFromServer(){await this.updateUserInfo();const t=await this.httpService.postDataToService("bag/getBag",{});this.userInfo.fruits=t,this.fruits=await this.httpService.getDataFromService("global-info/fruits"),this.fruitsBuff=await this.httpService.getDataFromService("global-info/buffs"),this.chapterData=await this.httpService.getDataFromService("global-info/levels"),this.configs=await this.httpService.getDataFromService("global-info/configs"),this.waves=await this.httpService.getDataFromService("global-info/waves"),this.monster=await this.httpService.getDataFromService("global-info/monsters"),this.fruitTalents=await this.httpService.getDataFromService("global-info/talents"),this.todayShop=await this.httpService.getDataFromService("shop/todayShop"),this.fruitLevels=await this.httpService.getDataFromService("global-info/fruit-level-ups")}async updateUserInfo(){const t=await this.httpService.postDataToService("user/userInfo",{}),{id:e,gold_amount:s,diamond_amount:i,level_id:o,last_get_free_gold_time:n,last_getfree_diamond_time:a,sign_day:r,last_sign_time:c,invite_code:h,invite_number:d,invite_rewards:u}=t;this.userInfo={uid:parseInt(e),golds:parseInt(s),diamonds:parseInt(i),chapterID:parseInt(o),lastGetFreeGoldsTime:n,lastGetFreeDiamondsTime:a,signDay:r,lastSignTime:c,inviteCode:h,inviteNum:Math.max(d,0),inviteGold:Math.max(u,0)}}get(t){return this.userInfo.hasOwnProperty(t)?this.userInfo[t]:null}updateGolds(t){if(this.userInfo.hasOwnProperty("golds")){if(this.userInfo.golds+t<0)return;this.userInfo.golds+=t,o.emit("coinsUpdated")}}updateDiamonds(t){if(this.userInfo.hasOwnProperty("diamonds")){if(this.userInfo.diamonds+t<0)return;this.userInfo.diamonds+=t,o.emit("diamondsUpdated")}}set(t,e){return this.userInfo.hasOwnProperty(t)&&(this.userInfo[t]=e),null}getConfig(t){return this.configs.hasOwnProperty(t)?this.configs[t]:null}getFruitById(t){return this.fruits["_"+t]??{}}getUserFruitById(t){return this.userInfo.fruits?this.userInfo.fruits[t]??{}:{}}getAllUserFruit(){return this.userInfo.fruits??{}}async updateFruit(){const t=await this.httpService.postDataToService("bag/getBag",{});this.userInfo.fruits=t}getFruitBuffById(t){return this.fruitsBuff[t]??{}}setCache(t,e){this.cache[t]=e,this.cacheExpiry[t]=Date.now()+this.cacheDuration}getCache(t){return this.cache[t]&&this.cacheExpiry[t]>Date.now()?this.cache[t]:null}clearCache(t){delete this.cache[t],delete this.cacheExpiry[t]}getFightWavesInfo(){return this.chapterData[this.fightLevelId].wave_ids.split(",").map((t=>parseInt(t.trim(),10))).map((t=>this.waves[t])).filter(Boolean)}getMonsterInfoById(t){return this.monster[t]}})._instance=void 0,u=f))||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/Grid.ts",["cc","./Pack.ts","./GameScene.ts"],(function(t){var e,i,o,s,n,r,l,c,d,a;return{setters:[function(t){e=t.cclegacy,i=t.color,o=t._decorator,s=t.Component,n=t.Sprite,r=t.Label,l=t.Rect,c=t.v2},function(t){d=t.Pack},function(t){a=t.GameScene}],execute:function(){var h,u;e._RF.push({},"657f4Ro8vtPMqTRvYI71BEX","Grid",void 0);const{ccclass:g,property:p}=o;t("Grid",g("Grid")(((u=class t extends s{constructor(){super(...arguments),this.idx=0,this.row=0,this.col=0,this.sprite=null,this._unlocked=!1,this.gameObj=null,this.debugLabel=null}get unlocked(){return this._unlocked}set unlocked(e){this._unlocked=e,this.sprite.color=e?t.defaultColor:t.alphaColor}setGameObj(t){this.gameObj=t}getGameObj(){return this.gameObj}isEmpty(){return null===this.gameObj}onLoad(){this.idx=this.node.getSiblingIndex(),this.row=Math.floor(this.idx/d.gridsHNum),this.col=this.idx%d.gridsHNum,this.sprite=this.node.getComponent(n),this.unlocked=!1,this.debugLabel=this.node.getChildByName("label").getComponent(r)}start(){}show(t){this.node.active=t}setColor(t){this.sprite.color=t}posInGrid(t){let e=58*a.editModeScale.x;return new l(this.node.getPosition().x-e,this.node.getPosition().y-e,2*e,2*e).contains(c(t.x,t.y))}update(t){}}).defaultColor=i("#fff5c0ff"),u.red=i("#FF0000"),u.green=i("#25E681ff"),u.alphaColor=i("#FFF5C064"),u.defaultWidth=116,h=u))||h);e._RF.pop()}}}));

System.register("chunks:///_virtual/GridObj.ts",["cc","./GameObj.ts"],(function(t){var e,r,s;return{setters:[function(t){e=t.cclegacy,r=t._decorator},function(t){s=t.GameObj}],execute:function(){var c;e._RF.push({},"93065fZ28tHE5TRJm/jfn6v","GridObj",void 0);const{ccclass:o,property:n}=r;t("GridObj",o("GridObj")(c=class extends s{start(){}onAddPack(){for(let t=0;t<this.coverGrids.length;t++)this.coverGrids[t].unlocked=!0;this.node.removeFromParent(),this.node.destroy()}update(t){}})||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/homeBottom.ts",["cc","./SpriteManager.ts","./AudioManager.ts","./ToastManager.ts"],(function(t){var e,n,o,s,c,i,r,a;return{setters:[function(t){e=t.cclegacy,n=t.Component,o=t.Sprite,s=t.director,c=t._decorator},function(t){i=t.SpriteManager},function(t){r=t.AudioManager},function(t){a=t.ToastManager}],execute:function(){var u;e._RF.push({},"fe4dfrRbqNM1INotvpzoVFe","homeBottom",void 0);const{ccclass:h,property:d}=c;t("homeBottom",h("homeBottom")(u=class extends n{constructor(){super(...arguments),this.currentActiveIndex=-1,this.sceneMap={0:"shop",1:"bag",2:"fightHome",3:"activity"},this.buttons=[],this.buttonLock=!1}init(t){if(this.buttonLock=!0,this.buttons=this.node.children.filter((t=>t.name.startsWith("btn"))),this.currentActiveIndex=t,this.buttons){const e=this.buttons.length;for(let n=0;n<e;n++){const e=this.buttons[n],s=e.getComponent(o);s?s.spriteFrame=n===t?i.getInstance().get("button-green-active"):i.getInstance().get("button-green"):console.warn(`No Sprite component found on ${e.name}`)}}else console.warn("No children found under this node");this.scheduleOnce((()=>{this.buttonLock=!1}),.5)}onButtonClick(t,e){if(this.buttonLock)return void a.show("Slow down,too fast.",2);const n=parseInt(e);if(this.currentActiveIndex==n)return;r.getInstance().playSnd("clickBtn");const o=this.sceneMap[n];s.loadScene(o)}})||u);e._RF.pop()}}}));

System.register("chunks:///_virtual/homeHeader.ts",["cc","./Global.ts","./Utils.ts"],(function(t){var e,o,s,d,n,a,i,r;return{setters:[function(t){e=t.cclegacy,o=t.Component,s=t.director,d=t.find,n=t.Label,a=t._decorator},function(t){i=t.Global},function(t){r=t.default}],execute:function(){var c;e._RF.push({},"3c95dJJoalL8Ia2roKVmLVv","homeHeader",void 0);const{ccclass:m,property:u}=a;t("homeHeader",m("homeHeader")(c=class extends o{onLoad(){this.updateGolds(),this.updateDiamonds(),s.on("coinsUpdated",this.updateGolds,this),s.on("diamondsUpdated",this.updateDiamonds,this)}updateGolds(){const t=d("gold/text",this.node),e=i.Instance.get("golds");t.getComponent(n).string=r.formatNumber(e)}updateDiamonds(){const t=d("diamond/text",this.node),e=i.Instance.get("diamonds");t.getComponent(n).string=r.formatNumber(e)}onDestroy(){s.off("coinsUpdated",this.updateGolds,this),s.off("diamondsUpdated",this.updateDiamonds,this)}start(){}})||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/httpClient.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"22bba7L1A1HcIapzgNnjz7a","httpClient",void 0);t("default",class{constructor(t,e,r){void 0===t&&(t=""),void 0===e&&(e=3),void 0===r&&(r=1e3),this.baseURL=void 0,this.retryCount=void 0,this.retryDelay=void 0,this.baseURL=t,this.retryCount=e,this.retryDelay=r}async delay(t){return new Promise((e=>setTimeout(e,t)))}async requestWithRetry(t,e,r,i,s){void 0===e&&(e="GET"),void 0===r&&(r=null),void 0===i&&(i={}),void 0===s&&(s=this.retryCount);const o=`${this.baseURL}${t}`,n={method:e,headers:{"Content-Type":"application/json",...i}};r&&(n.body=JSON.stringify(r));try{const t=await fetch(o,n);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return await t.json()}catch(o){if(console.error(`HTTP request failed: ${o.message}. Retries left: ${s}`),s>0)return await this.delay(this.retryDelay),this.requestWithRetry(t,e,r,i,s-1);throw new Error(`HTTP request failed after ${this.retryCount} retries: ${o.message}`)}}get(t,e){return void 0===e&&(e={}),this.requestWithRetry(t,"GET",null,e)}post(t,e,r){return void 0===r&&(r={}),this.requestWithRetry(t,"POST",e,r)}put(t,e,r){return void 0===r&&(r={}),this.requestWithRetry(t,"PUT",e,r)}delete(t,e){return void 0===e&&(e={}),this.requestWithRetry(t,"DELETE",null,e)}}),e._RF.pop()}}}));

System.register("chunks:///_virtual/httpService.ts",["cc","./httpClient.ts","./Global.ts"],(function(t){var e,o,n,r,s;return{setters:[function(t){e=t.sys,o=t.game,n=t.cclegacy},function(t){r=t.default},function(t){s=t.Global}],execute:function(){n._RF.push({},"7c296F2nY5ETr6zcWAFADWj","httpService",void 0);t("default",class{constructor(){this.httpClient=void 0,this.jwtToken=null,this.httpClient=new r("http://127.0.0.1:3001/api/"),this.jwtToken=null}async getOrRefreshJwtToken(){try{const t=e.localStorage.getItem("refresh_token");if(t){const o=await this.httpClient.post("user/refreshToken",{refreshToken:t});if(200===o.code&&o.data.token)return this.jwtToken=o.data.token,e.localStorage.setItem("jwt_token",this.jwtToken),this.jwtToken}const o=s.Instance.tgData.id,n=await this.httpClient.post("user/token",{telegram_id:o});return 200===n.code&&n.data.token?(this.jwtToken=n.data.token,e.localStorage.setItem("jwt_token",this.jwtToken),this.jwtToken):(console.error("Failed to obtain a new JWT token"),null)}catch(t){return console.error("Error during JWT token retrieval/refresh:",t),null}}async attachJwtTokenToRequest(){this.jwtToken||(this.jwtToken=await this.getOrRefreshJwtToken())}async getDataFromService(t){try{await this.attachJwtTokenToRequest();const e=await this.httpClient.get(t,this.getHeaders());return 200===e.code?e.data:(console.error("GET 请求失败:",e),o.end(),null)}catch(t){return console.error("GET 请求失败:",t),o.end(),null}}async postDataToService(t,e){try{await this.attachJwtTokenToRequest();const o=await this.httpClient.post(t,e,this.getHeaders());return 200===o.code?o.data:(console.error("POST 请求失败:",o),{msg:o.msg,code:o.code})}catch(t){return console.error("POST 请求失败:",t),{msg:"error",code:-1}}}getHeaders(){const t={};return this.jwtToken&&(t.Authorization=`Bearer ${this.jwtToken}`),t}}),n._RF.pop()}}}));

System.register("chunks:///_virtual/jump.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,n,r,o,u,s;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.initializerDefineProperty},function(t){n=t.cclegacy,r=t._decorator,o=t.Component,u=t.tween,s=t.v3}],execute:function(){var p,a,c,m;n._RF.push({},"4ecde1zvuZF2Lge8Sk33k50","jump",void 0);const{ccclass:h,property:l}=r;t("jump",h("jump")((c=e((a=class extends o{constructor(){super(...arguments),i(this,"jumpHeight",c,this),i(this,"jumpDuration",m,this)}start(){this.runJumpAnimation()}runJumpAnimation(){const t=u(this.node).by(this.jumpDuration/2,{position:s(0,this.jumpHeight)}),e=u(this.node).by(this.jumpDuration/2,{position:s(0,-this.jumpHeight)}),i=t.then(e);u(this.node).sequence(i).repeatForever().start()}}).prototype,"jumpHeight",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),m=e(a.prototype,"jumpDuration",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),p=a))||p);n._RF.pop()}}}));

System.register("chunks:///_virtual/load.ts",["cc"],(function(t){var e,o,s,r,a;return{setters:[function(t){e=t.cclegacy,o=t.Component,s=t.quat,r=t.Quat,a=t._decorator}],execute:function(){var c;e._RF.push({},"0e5ecnubz1KI75MGVOMhygM","load",void 0);const{ccclass:i,property:n}=a;t("load",i("load")(c=class extends o{constructor(){super(...arguments),this.rotate=0,this.q=s(0,0,0,0)}update(t){this.rotate+=1e3*t,r.fromEuler(this.q,0,0,-this.rotate%360),this.node.getChildByName("img").setRotation(this.q)}})||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/Loading.ts",["cc","./SpriteManager.ts","./Utils.ts","./PrefabManager.ts","./AudioManager.ts","./Global.ts","./telegram-web.ts"],(function(e){var t,a,s,n,o,r,i,l,c,d,g,h,p,u;return{setters:[function(e){t=e.cclegacy,a=e.Component,s=e.ProgressBar,n=e.UITransform,o=e.Label,r=e.director,i=e.assetManager,l=e._decorator},function(e){c=e.SpriteManager},function(e){d=e.default},function(e){g=e.PrefabManager},function(e){h=e.AudioManager},function(e){p=e.Global},function(e){u=e.TelegramWebApp}],execute:function(){var m;t._RF.push({},"5e8b3c9hopHoboAgM4PMq/u","Loading",void 0);const{ccclass:b,property:f}=l;e("Loading",b("Loading")(m=class extends a{constructor(){super(...arguments),this.progressBar=null,this.barUITrans=null,this.loadingLabel=null,this.loadedFileNum=0,this.loadingCompleted=!1,this.totalTasks=0,this.completedTasks=0}onLoad(){let e=d.getNodeFromCanvas("progress");this.progressBar=e.getComponent(s),this.barUITrans=e.children[0].getComponent(n),this.loadingLabel=this.progressBar.node.getChildByName("label").getComponent(o)}start(){let e=0;this.schedule((()=>{e++,this.loadingLabel.string=" Loading";for(let t=0;t<e%4;t++)this.loadingLabel.string+="."}),.5)}onDestroy(){this.unscheduleAllCallbacks()}async startLoading(e){await u.Instance.init().then((e=>{console.log("telegram web app init : ",e.success)}));const t={id:6335461272,first_name:"Kate",last_name:"",username:"kate_allways",language_code:"en"};if(!t)return void r.loadScene("404");p.Instance.tgData=t;const a=u.Instance.getTelegramStartParam();d.isEmpty(a)||p.Instance.bindUserInviteCode(a),localStorage.setItem("shop-discount-prod",""),localStorage.setItem("shop-discount-buy",""),this.totalTasks=5;let s=Date.now();this.totalTasks+=["shop","bag","fightHome","activity"].length,console.time("load_time"),await Promise.all([c.getInstance().load().then((()=>{this.completedTasks++,this.updateProgressBar()})),g.getInstance().load().then((()=>{this.completedTasks++,this.updateProgressBar()})),h.getInstance().load().then((()=>{this.completedTasks++,this.updateProgressBar()}))]),await p.Instance._initTonConnect().then((()=>{this.completedTasks++,this.updateProgressBar()})),await p.Instance.fetchGlobalDataFromServer().then((()=>{this.completedTasks++,this.updateProgressBar()})),await this.preloadScenes(),console.timeEnd("load_time"),s=Date.now()-s,s<2e3&&await d.sleep(2e3-s),r.loadScene(e)}loadSubpackages(){return new Promise(((e,t)=>{let a=["font","texture","resources"],s=0;for(let n=0;n<a.length;n++)i.loadBundle(a[n],null,((n,o)=>{n?t(n):(s++,s===a.length&&e(null))}))}))}async preloadScenes(){return new Promise(((e,t)=>{const a=["shop","bag","fightHome","activity"];let s=a.length,n=0;a.forEach((a=>{r.preloadScene(a,((e,t,a)=>{this.completedTasks+=e,this.updateProgressBar()}),((a,o)=>{a?t(a):(n++,n===s&&e(o))}))}))}))}updateProgressBar(){let e=this.completedTasks/this.totalTasks;e=Math.min(e,1),this.progressBar.progress=e,this.barUITrans.width=538*e}})||m);t._RF.pop()}}}));

System.register("chunks:///_virtual/loseAlert.ts",["cc","./AudioManager.ts"],(function(t){var e,n,c,o,r,a;return{setters:[function(t){e=t.cclegacy,n=t.Component,c=t.Button,o=t.director,r=t._decorator},function(t){a=t.AudioManager}],execute:function(){var s;e._RF.push({},"1673fBvbUVLb7YzMat4/sNh","loseAlert",void 0);const{ccclass:l,property:i}=r;t("loseAlert",l("loseAlert")(s=class extends n{onBackBtnClick(t){const e=t.currentTarget.getComponent(c);e.interactable=!1,a.getInstance().playSnd("clickBtn"),o.loadScene("fightHome"),e.interactable=!0}})||s);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./telegram-web.ts","./AudioManager.ts","./BaseApp.ts","./GameApp.ts","./GameConfig.ts","./Global.ts","./Loading.ts","./MathUtil.ts","./NodePoolMap.ts","./Platform.ts","./PrefabManager.ts","./SpriteManager.ts","./StringUtil.ts","./Utils.ts","./Buff.ts","./Bullet.ts","./Damage.ts","./FadeoutEffect.ts","./Fruit.ts","./FruitManager.ts","./GameLevel.ts","./GameObj.ts","./GameScene.ts","./Grid.ts","./GridObj.ts","./MainUI.ts","./Monster.ts","./Pack.ts","./RuHua.ts","./TDGame.ts","./Tip.ts","./loseAlert.ts","./victoryAlert.ts","./ToastManager.ts","./activityManager.ts","./bagManager.ts","./fightManager.ts","./homeBottom.ts","./homeHeader.ts","./shopManager.ts","./successAlert.ts","./httpService.ts","./DrawSquare.ts","./httpClient.ts","./jump.ts","./load.ts","./timeCountDown.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MainUI.ts",["cc","./FruitManager.ts","./TDGame.ts","./Pack.ts","./Tip.ts","./SpriteManager.ts","./GameScene.ts","./AudioManager.ts","./PrefabManager.ts","./Global.ts","./victoryAlert.ts","./ToastManager.ts","./httpService.ts","./Utils.ts","./Buff.ts"],(function(t){var e,n,s,i,a,o,c,r,l,h,g,d,u,m,f,p,I,v,B,y,C,S,k,w,G;return{setters:[function(t){e=t.cclegacy,n=t._decorator,s=t.Component,i=t.Label,a=t.instantiate,o=t.Button,c=t.Vec3,r=t.Sprite,l=t.tween,h=t.Color},function(t){g=t.FruitManager},function(t){d=t.TDGame,u=t.GameState},function(t){m=t.Pack},function(t){f=t.Tip},function(t){p=t.SpriteManager},function(t){I=t.GameScene},function(t){v=t.AudioManager},function(t){B=t.PrefabManager},function(t){y=t.Global},function(t){C=t.victoryAlert},function(t){S=t.ToastManager},function(t){k=t.default},function(t){w=t.default},function(t){G=t.Buff}],execute:function(){var b,U;e._RF.push({},"699b3RFPB1A8JqfisnBtWY0","MainUI",void 0);const{ccclass:N,property:T}=n;t("MainUI",N("MainUI")(((U=class t extends s{constructor(){super(...arguments),this.needScaleX=[1004,1010,1011,1012],this.needScaleY=[1008],this.damageRank={},this.inited=!1,this.startGameBtn=null,this.refreshPlusBtn=null,this.refreshBtn=null,this.confirmBtn=null,this.gridGetBtn=null,this.gridResCount=0,this.loseUI=null,this.victoryUI=null,this.levelupUI=null,this.bossComingUI=null,this.silverUI=null,this.httpService=void 0,this.takeAllTalentCount=0,this.victoryAdd=0,this.nowShowBuffs=[]}static getInstance(){return t.instance}onLoad(){t.instance=this,this.schedule((()=>{I.getInstance().addDamageRankToBottom(this.damageRank)}),5),this.init()}init(){if(this.inited)return;this.httpService=new k;let t=this.node.getChildByName("bottom");this.startGameBtn=t.getChildByName("startGameBtn"),this.refreshPlusBtn=t.getChildByName("refreshPlusBtn"),this.refreshBtn=t.getChildByName("refreshBtn"),this.confirmBtn=t.getChildByName("confirmBtn"),this.gridGetBtn=t.getChildByName("grid-get"),this.gridGetBtn.getChildByName("num").getComponent(i).string=y.Instance.getConfig("extraGridPerGame"),this.loseUI=this.node.getChildByName("loseUI"),this.victoryUI=this.node.getChildByName("victoryUI"),this.levelupUI=this.node.getChildByName("levelUpUI"),this.bossComingUI=this.node.getChildByName("bossComing"),this.silverUI=this.node.getChildByName("silver"),this.updateSilverNum(),this.silverUI.active=!0,this.inited=!0,this.bossComingUI.active=!1;let e=a(B.getInstance().get("victoryAlert"));this.victoryUI.addChild(e),e=a(B.getInstance().get("loseAlert")),this.loseUI.addChild(e)}enterFillPackMode(){this.startGameBtn.active=!0,this.refreshPlusBtn.active=!0,this.gridGetBtn.active=!0,this.refreshBtn.active=!0,this.confirmBtn.active=!1,this.bossComingUI.active=!1}enterEditPackMode(){this.startGameBtn.active=!1,this.refreshPlusBtn.active=!1,this.gridGetBtn.active=!1,this.refreshBtn.active=!1,this.confirmBtn.active=!0}enterGame(){this.startGameBtn.active=!1,this.refreshPlusBtn.active=!1,this.gridGetBtn.active=!1,this.refreshBtn.active=!1,this.confirmBtn.active=!1}onRefreshClicked(e){const n=e.currentTarget.getComponent(o);n.interactable=!1,v.getInstance().playSnd("clickBtn");let s=d.getInstance().silver;const i=parseInt(y.Instance.getConfig("refreshSliverPrice"));s<i?S.show("Not enough silver coins",2):(d.getInstance().addSilver(-i),t.getInstance().updateSilverNum(),g.getInstance().refreshGameObjs()),this.scheduleOnce((()=>{n.interactable=!0}),1)}onRefreshPlusClicked(t){const e=t.currentTarget.getComponent(o);e.interactable=!1,v.getInstance().playSnd("clickBtn");let n=y.Instance.get("golds");const s=parseInt(y.Instance.getConfig("refreshLv2Price"));n<s?S.show("Not enough golds",2):(y.Instance.updateGolds(-s),this.httpService.postDataToService("fight/costToken",{config_key:"refreshLv2Price",token_type:2}),g.getInstance().refreshGameObjs(!0)),this.scheduleOnce((()=>{e.interactable=!0}),1)}onGenerateGridCostDiamond(t){const e=t.currentTarget.getComponent(o);if(e.interactable=!1,v.getInstance().playSnd("clickBtn"),this.gridResCount>=y.Instance.getConfig("extraGridPerGame"))return S.show("Out of refresh attempts",2),void this.gridGetBtn.destroy();const n=parseInt(y.Instance.getConfig("extraGridPerGamePrice"));if(y.Instance.get("diamonds")<n)S.show("Not enough diamonds",2);else{this.gridResCount+=1;const t=y.Instance.getConfig("extraGridPerGame")-this.gridResCount;t<=0?this.gridGetBtn.destroy():this.gridGetBtn.getChildByName("num").getComponent(i).string=t.toString(),y.Instance.updateDiamonds(-n),this.httpService.postDataToService("fight/costToken",{config_key:"extraGridPerGamePrice",token_type:1}),g.getInstance().spawnGameObjsOnlyGrid()}this.scheduleOnce((()=>{e.interactable=!0}),1)}onStartGameClicked(t){const e=t.currentTarget.getComponent(o);e.interactable=!1,v.getInstance().playSnd("clickBtn"),m.getInstance().gameObjs.length>0?d.getInstance().enterGame():f.getInstance().showTip("Place at least one fruit"),this.scheduleOnce((()=>{e.interactable=!0}),1)}onConfirmClicked(t){const e=t.currentTarget.getComponent(o);e.interactable=!1,v.getInstance().playSnd("clickBtn"),d.getInstance().enterFillPackMode(),this.scheduleOnce((()=>{e.interactable=!0}),1)}showLoseUI(t){v.getInstance().playSnd("战斗失败"),this.loseUI.active=t}async showVictoryUI(t){const e=y.Instance.fightLevelId;d.getInstance().openLoading();const n=await this.httpService.postDataToService("fight/game/winReward",{level_id:e,reward_add:this.victoryAdd});if(d.getInstance().closeLoading(),!w.isEmpty(n.code))return void S.show(n.msg,2);v.getInstance().playSnd("战斗胜利");const s=n.newGoldAmount,i=n.allocatedFragments;let a=[];s>0&&(a.push({iconFrameName:"golds",num:s}),y.Instance.updateGolds(s)),y.Instance.updateUserInfo(),y.Instance.updateFruit();for(const t in i){const e=i[t],n=parseInt(t),s=y.Instance.getFruitById(n).quality;a.push({fruitId:n,iconFrameName:n+"-1",num:e,level:s,needScale:!0})}this.victoryUI.getChildByName("victoryAlert").getComponent(C).updateItems(a),this.victoryUI.active=t}showBossComeingUI(){v.getInstance().playSnd("boss来了"),this.bossComingUI.active=!0;const t=this.bossComingUI.getChildByName("img");this.shakeNode(t,1.5,10,(()=>{this.bossComingUI.active=!1}))}showLevelupUI(t){t&&this.generateBuff(),this.levelupUI.active=t}getRandomItems(t,e){const n=Object.values(t);if(e>n.length)return n;return n.sort((()=>.5-Math.random())).slice(0,e)}generateBuff(){v.getInstance().playSnd("clickBtn");const t=this.levelupUI.getChildByName("buff"),e=y.Instance.fruitsBuff,n=this.getRandomItems(e,3);for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){let a=t.children[e];const l=n[e],h=l.quality;let g="";g=3==h?"buff-purple":2==h?"buff-blue":"buff-green";let m="",f=new c(1,1,1);const I=l.fruit_id;w.isEmpty(I)?1==l.type?m="atk-"+l.value:2==l.type?m="speed-"+l.value:5==l.type?m="lowspeed-"+l.value:10==l.type&&(m="exp-"+l.value):(m=I+"-1",-1!=this.needScaleX.indexOf(I)&&(f.x=.5),-1!=this.needScaleY.indexOf(I)&&(f.y=.5),1010==I&&(f.x=.3)),a.getChildByName("bg").getComponent(r).spriteFrame=p.getInstance().get(g),a.getChildByName("icon").scale=f,a.getChildByName("icon").getComponent(r).spriteFrame=p.getInstance().get(m);var s=l.memo??"";s&&-1!==s.indexOf("X")&&(s=s.replace(/X/g,l.value)),a.getChildByName("text").getComponent(i).string=s;const B=l.type,y=l.value,C=l.time;this.nowShowBuffs.push({fruitId:I,type:B,addNum:y,time:C}),a.getComponent(o)&&(a.off("click"),a.on("click",(()=>{v.getInstance().playSnd("clickBtn"),G.getInstance().applyBuffs(I,B,y,C),this.nowShowBuffs=[],this.showLevelupUI(!1),d.getInstance().gameState=u.gameing})))}}talentsRefreshBtnClick(t){const e=t.currentTarget.getComponent(o);e.interactable=!1,v.getInstance().playSnd("clickBtn");let n=y.Instance.get("golds");const s=parseInt(y.Instance.getConfig("refreshTalentPrice"));n<s?S.show("Not enough golds",2):(y.Instance.updateGolds(-s),this.httpService.postDataToService("fight/costToken",{config_key:"refreshTalentPrice",token_type:2}),this.generateBuff()),this.scheduleOnce((()=>{e.interactable=!0}),1)}talentsTakeAllBtnClick(t){const e=t.currentTarget.getComponent(o);e.interactable=!1,v.getInstance().playSnd("clickBtn");let n=y.Instance.get("diamonds");const s=parseInt(y.Instance.getConfig("takeAllTalentPrice"));if(n<s)S.show("Not enough diamonds",2);else{const t=parseInt(y.Instance.getConfig("takeAllTalentLimit"));if(console.log(t),console.log(this.takeAllTalentCount),this.takeAllTalentCount>=t)S.show(`No more than ${t} times`,2);else{if(y.Instance.updateDiamonds(-s),this.httpService.postDataToService("fight/costToken",{config_key:"takeAllTalentPrice",token_type:1}),this.nowShowBuffs.length>0){for(const t in this.nowShowBuffs)if(Object.prototype.hasOwnProperty.call(this.nowShowBuffs,t)){const e=this.nowShowBuffs[t],n=e.fruitId;G.getInstance().applyBuffs(n,e.type,e.addNum,e.time)}this.nowShowBuffs=[],this.showLevelupUI(!1),d.getInstance().gameState=u.gameing}this.takeAllTalentCount+=1}}this.scheduleOnce((()=>{e.interactable=!0}),1)}getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}onRestartGameClicked(){v.getInstance().playSnd("clickBtn"),this.showLoseUI(!1),d.getInstance().restartGame()}shakeNode(t,e,n,s){const i=t.position.clone(),a=l(t).by(.05,{position:new c(0,n,0)}).by(.1,{position:new c(0,-2*n,0)}).by(.05,{position:new c(0,n,0)}).union().repeatForever();setTimeout((()=>{a.stop(),t.setPosition(i),s&&s()}),1e3*e),a.start()}updateSilverNum(){const t=d.getInstance().silver;this.silverUI.getChildByName("num").getComponent(i).string=t.toString();const e=this.refreshBtn.getChildByName("num").getComponent(i);e.string=t.toString(),e.color=t<=0?new h(255,0,0):new h(255,255,255)}updateDamageRank(t,e){this.damageRank[t]?this.damageRank[t]+=e:this.damageRank[t]=e}}).instance=null,b=U))||b);e._RF.pop()}}}));

System.register("chunks:///_virtual/MathUtil.ts",["cc"],(function(t){var r,e;return{setters:[function(t){r=t.v2,e=t.cclegacy}],execute:function(){e._RF.push({},"ea1ec7/vEtNU6twGJ27fO+Y","MathUtil",void 0);class a{static randNumber(t){return Math.floor(Math.random()*t+1)}static randRangeNumber(t,r){let e=r-t;return t+Math.round(Math.random()*e)}static randRangeExclude(t,r,e){if(t===r)return t;let n=a.randRangeNumber(t,r);for(;n===e;)n=a.randRangeNumber(t,r);return n}static randExtract(t,r,e){void 0===e&&(e=!1);let n=[];for(;n.length<r;){let r=a.randNumber(t),e=!1;for(let t=0;t<n.length;t++)if(n[t]===r){e=!0;break}!1===e&&n.push(r)}return e&&n.sort((function(t,r){return t-r})),n}static toRadian(t){return t*Math.PI/180}static calcLineIntersection(t,e,a,n){const c=(t.x-e.x)*(a.y-n.y)-(t.y-e.y)*(a.x-n.x);if(0===c)return null;const u=((t.x-a.x)*(a.y-n.y)-(t.y-a.y)*(a.x-n.x))/c,i=-((t.x-e.x)*(t.y-a.y)-(t.y-e.y)*(t.x-a.x))/c;if(u>=0&&u<=1&&i>=0&&i<=1){const a=t.x+u*(e.x-t.x),n=t.y+u*(e.y-t.y);return r(a,n)}return null}static vec2ToDegree(t){let r=Math.atan2(t.y,t.x)*(180/Math.PI);return r=(r-90)%360,r<0&&(r+=360),r}static CeilFloat(t,r){var e=(Math.ceil(100*t)/100).toFixed(r);return parseFloat(e)}static removeValueFromArray(t,r){const e=t.indexOf(r);-1!==e&&t.splice(e,1)}static modulo(t,r){return t-Math.floor(t/r)*r}static clamp(t,r,e){return Math.max(r,Math.min(e,t))}}t("default",a),a.msDay=864e5,a.msHour=36e5,a.msMin=6e4,e._RF.pop()}}}));

System.register("chunks:///_virtual/Monster.ts",["cc","./NodePoolMap.ts","./GameConfig.ts","./GameScene.ts","./AudioManager.ts","./SpriteManager.ts","./TDGame.ts","./PrefabManager.ts","./Damage.ts","./Global.ts","./Buff.ts","./Utils.ts","./MainUI.ts"],(function(t){var e,s,i,a,n,o,h,r,c,d,p,g,l,m,u,f,v,P,I,D,B,x;return{setters:[function(t){e=t.cclegacy,s=t.Component,i=t.v3,a=t.Vec3,n=t.UITransform,o=t.ProgressBar,h=t.Sprite,r=t.instantiate,c=t._decorator},function(t){d=t.default},function(t){p=t.NodePoolName},function(t){g=t.GameScene},function(t){l=t.AudioManager},function(t){m=t.SpriteManager},function(t){u=t.TDGame,f=t.GameState},function(t){v=t.PrefabManager},function(t){P=t.Damage},function(t){I=t.Global},function(t){D=t.Buff},function(t){B=t.default},function(t){x=t.MainUI}],execute:function(){var y;e._RF.push({},"ffb43x4K0VFdoacsxR/7BYk","Monster",void 0);const{ccclass:M,property:S}=c;t("Monster",M("Monster")(y=class extends s{constructor(){super(...arguments),this.sprite=null,this.active=!1,this.inited=!1,this.isDeath=!1,this.movSpeed=100,this.movDir=i(0,0,0),this.monsterExp=15,this.totalHp=500,this._hp=500,this._expectHp=this.hp,this.movLen=i(0,0,0),this.pos2Target=i(-186.701,402,0),this.isBoss=1,this.targetPointIdx=1,this.hpBar=null,this.attackers=[],this.monsterId=0,this.moveProgress=0,this.distanceTraveled=0,this.totalPathLength=0,this.isBloodActive=!1,this.isPoisonActive=!1}get hp(){return this._hp}set hp(t){this._hp=t,this._hp<0&&(this._hp=0,this.death()),this.hpBar.progress=this._hp/this.totalHp}get expectHp(){return this._expectHp}set expectHp(t){this._expectHp=t}onLoad(){this.distanceTraveled=0,this.totalPathLength=this.calculateTotalPathLength()}calculateTotalPathLength(){let t=0;var e=g.getInstance().pathPoints;for(let s=0;s<e.length-1;s++)t+=a.distance(e[s+1],e[s]);return t}getMoveProcess(){return this.moveProgress}setMonsterId(t,e){if(t<0)return;this.monsterId=t,this.init();const s=I.Instance.getMonsterInfoById(t);let i=m.getInstance().get(s.img);this.sprite.spriteFrame=i;let o=this.sprite.node.getComponent(n),h=i.originalSize.width,r=i.originalSize.height;this.isBoss=s.is_boss,this.isBoss||(h*=.7,r*=.7),o.setContentSize(h,r);const c=e*s.blood;this.movSpeed=s.speed,this.totalHp=c,this.hp=this.totalHp,this.monsterExp=s.exp;let d=this.sprite.node.getComponent(n);this.hpBar.node.setPosition(0,.5*d.contentSize.y+20,0),this.isBoss||(this.hpBar.node.scale=new a(.8,.8,0)),D.getInstance().newMonsterApplyDeBuffs(this)}setDeBuff(t,e){void 0===e&&(e=0),t&&(this.movSpeed=t),e&&(this.monsterExp=e)}init(){this.inited||(this.inited=!0,this.active=!0,this.isDeath=!1,this.movDir.set(-1,0,0),this.hpBar=this.node.getChildByName("hpBar").getComponent(o),this.sprite=this.node.getChildByName("sprite").getComponent(h),this.inited=!0)}reset(){this.active=!1,this.node.active=!0,this.inited=!1,this.isDeath=!1,this.hp=500,this.totalHp=500,this.movSpeed=100,this.targetPointIdx=1,this.movDir.set(-1,0,0),this.attackers.splice(0,this.attackers.length)}destroyMonster(){this.node.removeFromParent(),this.node.destroy()}move(t){if(this.targetPointIdx>=g.getInstance().pathPoints.length)return;a.multiplyScalar(this.movLen,this.movDir,t*this.movSpeed);let e=this.movLen.length(),s=g.getInstance().pathPoints[this.targetPointIdx];a.subtract(this.pos2Target,s,this.node.getPosition());let n=this.pos2Target.length();if(this.distanceTraveled+=t*this.movSpeed,this.moveProgress=this.distanceTraveled/this.totalPathLength,e>=n?(this.node.setPosition(g.getInstance().pathPoints[this.targetPointIdx]),this.targetPointIdx++,this.updateMovDir()):(a.add(this.movLen,this.node.getPosition(),this.movLen),this.node.setPosition(this.movLen)),this.targetPointIdx===g.getInstance().pathPoints.length){let t=i(0,0,0);if(a.subtract(t,g.getInstance().ruhua.node.getPosition(),this.node.getPosition()),t.length()<40){for(let t=0;t<this.attackers.length;t++)this.attackers[t].clearAttackTarget();this.isDeath=!0,this.active=!1,this.node.active=!1,g.getInstance().ruhua.damage(this.isBoss)}}}updateMovDir(){1===this.targetPointIdx?this.movDir.set(1,0,0):2===this.targetPointIdx?this.movDir.set(0,-1,0):3===this.targetPointIdx?this.movDir.set(1,0,0):4===this.targetPointIdx?this.movDir.set(0,1,0):5===this.targetPointIdx&&this.movDir.set(-1,0,0)}onDamage(t){this.isDeath||(l.getInstance().playSnd("damage"),this.applyDamage(t.shooter.getFruitId(),t.damage,t.isCrit),B.isEmpty(t.shooter.specBuff)||this.specBuffDamage(t.shooter.getFruitId(),t.shooter.specBuff))}applyDamage(t,e,s){let i=this.node.getChildByName("damageNum"),a=r(v.getInstance().get("damage"));i.addChild(a);let n=a.getComponent(P);n?n.setDamage("-"+e,s):console.error("damage component not found on damagePrefab"),this.hp-=e,x.getInstance().updateDamageRank(t,e)}specBuffDamage(t,e){const s=this.node.getChildByPath("sprite/debuff");for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i)){const a=e[i],n=a.type,o=a.value,h=a.time;if(11==n){this.schedule((()=>{this.applyDamage(t,o,2)}),1,h);const e=s.getChildByName("blood");this.isBloodActive||(e.active=!0,this.isBloodActive=!0,this.scheduleOnce((()=>{e.active=!1,this.isBloodActive=!1}),h+1))}else if(14==n){const e=Math.ceil(this.totalHp*(o/100));this.scheduleOnce((()=>{this.applyDamage(t,e,4)}),.5)}else if(16==n){this.schedule((()=>{this.applyDamage(t,o,3)}),1,h);const e=s.getChildByName("poison");this.isPoisonActive||(e.active=!0,this.isPoisonActive=!0,this.scheduleOnce((()=>{e.active=!1,this.isPoisonActive=!1}),h+1))}}}addAttacker(t){for(let e=0;e<this.attackers.length;e++)if(this.attackers[e]===t)return;this.attackers.push(t)}death(){if(this.isDeath)return;this.isDeath=!0,l.getInstance().playSnd("death");let t=d.get(p.DeathEffect);g.getInstance().addEffect(t,i(this.node.getPosition().x,this.node.getPosition().y+100,0));for(let t=0;t<this.attackers.length;t++)this.attackers[t].clearAttackTarget();this.active=!1,this.node.active=!1,u.getInstance().exp=this.monsterExp}isExpectDeath(){return this.expectHp<=0}update(t){u.getInstance().gameState===f.gameing&&this.inited&&this.active&&this.move(t)}})||y);e._RF.pop()}}}));

System.register("chunks:///_virtual/NodePoolMap.ts",["cc"],(function(o){var e,t,l,n;return{setters:[function(o){e=o.Node,t=o.instantiate,l=o.cclegacy,n=o.NodePool}],execute:function(){l._RF.push({},"a033cJ91S9EfIla4LR8KL0J","NodePoolMap",void 0);class a{constructor(o){this.nodePrefab=null,this.nodePool=null,this.nodePrefab=o,this.nodePool=new n}}class p{static createPool(o,l,n){if(void 0===n&&(n=0),!l)return;if(o.trim().length<=0)return;if(o in p.poolMap)return;let i=null;i=l instanceof e?l:t(l);let r=new a(i);if(p.poolMap[o]=r,n>0&&l)for(let o=0;o<n;o++){let o=t(i);r.nodePool.put(o)}}static get(o){if(o in p.poolMap){let e=p.poolMap[o].nodePool.get();return e||(p.create(o),p.poolMap[o].nodePool.get())}return null}static create(o,e){if(void 0===e&&(e=5),o in p.poolMap)for(let l=0;l<e;l++){let e=t(p.poolMap[o].nodePrefab);p.poolMap[o].nodePool.put(e)}}static put(o,e){e&&o in p.poolMap&&p.poolMap[o].nodePool.put(e)}}o("default",p),p.poolMap={},l._RF.pop()}}}));

System.register("chunks:///_virtual/Pack.ts",["cc","./Grid.ts","./GameObj.ts","./FruitManager.ts","./Fruit.ts"],(function(e){var t,i,s,o,r,n,d,l,g,h;return{setters:[function(e){t=e.cclegacy,i=e._decorator,s=e.Component,o=e.Sprite,r=e.UITransform,n=e.Vec3},function(e){d=e.Grid},function(e){l=e.GameObjType},function(e){g=e.FruitManager},function(e){h=e.Fruit}],execute:function(){var a,c;t._RF.push({},"76dcew6kPNMsL/nLJKaUpCZ","Pack",void 0);const{ccclass:u,property:p}=i;e("Pack",u("Pack")(((c=class e extends s{constructor(){super(...arguments),this.bgSprite=null,this.bgUITrans=null,this.grids=[],this.gridsParent=null,this.gameObjs=[],this.attachNode=null,this.buffsMap=new Map}static getInstance(){return e.instance}onLoad(){e.instance=this,this.bgSprite=this.node.getChildByName("bg").getComponent(o),this.bgUITrans=this.bgSprite.node.getComponent(r),this.gridsParent=this.node.getChildByName("grids"),this.attachNode=this.node.getChildByName("attach");for(let e=0;e<this.gridsParent.children.length;e++)this.grids.push(this.gridsParent.children[e].getComponent(d))}start(){}init(){let e=[11,12,13,16,17,18,21,22,23];for(let t=0;t<e.length;t++){const i=e[t];this.grids[i].unlocked=!0}this.displayUnlockedGrids(),this.updateBgContentSize()}reset(){for(let e=0;e<this.grids.length;e++)this.grids[e].unlocked=!1,this.grids[e].setGameObj(null);this.gameObjs.splice(0,this.gameObjs.length),this.attachNode.destroyAllChildren(),this.attachNode.removeAllChildren(),this.init()}updateBgContentSize(t){void 0===t&&(t=!1);let i=0,s=0,o=99,r=-1,n=99,l=-1,g=null,h=0;for(let i=0;i<e.gridsVNum;i++)for(let s=0;s<e.gridsHNum;s++)h=i*e.gridsHNum+s,g=this.grids[h],(g.unlocked||t)&&(g.row<o&&(o=g.row),g.row>r&&(r=g.row),g.col<n&&(n=g.col),g.col>l&&(l=g.col));i=r-o+1,s=l-n+1;let a=s*d.defaultWidth+(s-1)*e.gridInterval,c=i*d.defaultWidth+(i-1)*e.gridInterval;console.log(c,a),this.bgUITrans.setContentSize(a,c)}displayUnlockedGrids(){for(let e=0;e<this.grids.length;e++)this.grids[e].unlocked?this.grids[e].show(!0):this.grids[e].show(!1)}displayAllGrids(){for(let e=0;e<this.grids.length;e++)this.grids[e].show(!0)}enterFillPackMode(){console.log(this.node),this.node.setPosition(0,150,0),this.displayUnlockedGrids();let e=9999,t=-9999,i=9999,s=-9999;for(let o=0;o<this.grids.length;o++){if(!this.grids[o].unlocked)continue;let r=this.grids[o].node.getPosition();r.x<e&&(e=r.x),r.x>t&&(t=r.x),r.y<i&&(i=r.y),r.y>s&&(s=r.y)}let o=e+.5*(t-e),r=i+.5*(s-i),n=this.node.getPosition();console.log(n),console.log(o),console.log(r),this.node.setPosition(-o,n.y,0),n=this.bgSprite.node.getPosition(),console.log(o,r,n.z),this.bgSprite.node.setPosition(o,r,n.z),this.updateBgContentSize()}enterEditPackMode(){let e=this.node.getPosition();this.node.setPosition(0,150,0),e=this.bgSprite.node.getPosition(),this.bgSprite.node.setPosition(0,0,0),this.displayAllGrids(),this.updateBgContentSize(!0)}enterGame(){let e=9999,t=-9999,i=9999,s=-9999;for(let o=0;o<this.grids.length;o++){if(!this.grids[o].unlocked)continue;let r=this.grids[o].node.getPosition();r.x<e&&(e=r.x),r.x>t&&(t=r.x),r.y<i&&(i=r.y),r.y>s&&(s=r.y)}let o=e+.5*(t-e),r=i+.5*(s-i);console.log("开始进入游戏"),console.log(-o,-r-100,0),this.node.setPosition(-o,-r,0)}updateByDragingObj(e){if(!e){for(let e=0;e<this.grids.length;e++)this.grids[e].unlocked?this.grids[e].setColor(d.defaultColor):this.grids[e].setColor(d.alphaColor);return}let t=!1;e.objType===l.Grid&&(t=!0);let i=[];for(let s=0;s<e.gridsParent.children.length;s++){let o=e.gridsParent.children[s].getComponent(r).convertToWorldSpaceAR(n.ZERO),d=this.gridsParent.getComponent(r).convertToNodeSpaceAR(o),l=-1;if(l=t?this.posInLockedGrid(d):this.posInUnlockedGrid(d),l>=0){let e=!1;for(let t=0;t<i.length;t++)if(i[t]===l){e=!0;break}e||i.push(l)}}for(let e=0;e<this.grids.length;e++)this.grids[e].unlocked?this.grids[e].setColor(d.defaultColor):this.grids[e].setColor(d.alphaColor);let s=!0,o=0,g=null;if(!t){let t=e.node.getComponent(h);for(let r=0;r<i.length;r++){let n=this.grids[i[r]].getGameObj();if(null!==n){let i=n.getComponent(h);if(n===e)continue;if(i.getFruitId()===t.getFruitId()&&i.getLevel()===t.getLevel()){g=i,o++;continue}s=!1;break}}}g&&o!==i.length&&(s=!1),e.clearCoverGrids();for(let o=0;o<i.length;o++)i.length===e.gridsParent.children.length?t?(this.grids[i[o]].setColor(d.defaultColor),e.addCoverGrid(this.grids[i[o]])):s?(this.grids[i[o]].setColor(d.green),e.addCoverGrid(this.grids[i[o]])):(this.grids[i[o]].setColor(d.red),e.addCoverGrid(this.grids[i[o]])):this.grids[i[o]].setColor(d.red)}posInUnlockedGrid(e){for(let t=0;t<this.grids.length;t++){if(!this.grids[t].unlocked)continue;if(this.grids[t].posInGrid(e))return t}return-1}posInLockedGrid(e){for(let t=0;t<this.grids.length;t++){if(this.grids[t].unlocked)continue;if(this.grids[t].posInGrid(e))return t}return-1}addGameObj(t){if(!t)return;let i=!0,s=0,o=null;if(t.objType===l.Fruit)for(let e=0;e<t.coverGrids.length;e++){let r=t.coverGrids[e].getGameObj();if(null!==r){let e=r.getComponent(h);if(e===t)continue;if(e.getFruitId()===t.getComponent(h).getFruitId()&&e.getLevel()===t.getComponent(h).getLevel()&&e.getLevel()<4){s++,o=e;continue}i=!1;break}}o&&s!==t.coverGrids.length&&(i=!1,o=null),t.objType===l.Fruit?t.node.parent===g.getInstance().attachNode?i?(g.getInstance().removeGameObj(t),o?o.merge(t):(this.attachNode.addChild(t.node),t.onAddPack(),this.gameObjs.push(t))):(t.clearCoverGrids(),t.changeTweenPos(t.posBeforeDraing.x,t.posBeforeDraing.y)):t.node.parent===e.getInstance().attachNode&&(i?o&&o!==t?o.merge(t):t.moveToCoverGrids():t.backToFillGrids()):(g.getInstance().removeGameObj(t),t.onAddPack())}removeGameObj(e){if(e)for(let t=0;t<this.gameObjs.length;t++)if(this.gameObjs[t]===e)return this.gameObjs[t].onRemoveFromPack(),void this.gameObjs.splice(t,1)}update(e){}}).gridsHNum=5,c.gridsVNum=7,c.gridsNum=c.gridsHNum*c.gridsVNum,c.bgMargin=15,c.gridInterval=15,c.instance=null,a=c))||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/Platform.ts",["cc"],(function(e){var t,i,s,n,r,o;return{setters:[function(e){t=e.cclegacy,i=e._decorator,s=e.Component,n=e.v2,r=e.view,o=e.sys}],execute:function(){var a,h;t._RF.push({},"1f75azrNt9AeIu4mTZ+eBw4","Platform",void 0);const{ccclass:l,property:c}=i;let f=e("PlatformType",function(e){return e[e.Unknown=0]="Unknown",e[e.WebMobile=1]="WebMobile",e[e.WebPC=2]="WebPC",e[e.Wechat=3]="Wechat",e[e.Android=4]="Android",e[e.IOS=5]="IOS",e}({}));e("Platform",l("Platform")(((h=class e extends s{constructor(){super(...arguments),this._platformType=f.Unknown,this._screenSize=n(0,0),this._halfScreenSize=n(0,0),this._designSize=n(0,0),this._halfDesignSize=n(0,0)}static getInstance(){return e.instance}get platformType(){return this._platformType}get screenSize(){return this._screenSize}get halfScreenSize(){return this._halfScreenSize}get designSize(){return this._designSize}get halfDesignSize(){return this._halfDesignSize}onLoad(){e.instance=this,this.init()}start(){}init(){this.decidePlatform();const e=r.getVisibleSize();this._screenSize.x=e.width,this._screenSize.y=e.height,this._halfScreenSize.x=.5*this._screenSize.x,this._halfScreenSize.y=.5*this._screenSize.y;const t=r.getDesignResolutionSize();this._designSize.x=t.width,this._designSize.y=t.height,this._halfDesignSize.x=.5*this._designSize.x,this._halfDesignSize.y=.5*this._designSize.y}decidePlatform(){this._platformType=f.Unknown,console.log("cur platform="+o.platform),o.platform===o.Platform.MOBILE_BROWSER?this._platformType=f.WebMobile:o.platform===o.Platform.DESKTOP_BROWSER?this._platformType=f.WebPC:o.platform===o.Platform.ANDROID?this._platformType=f.Android:o.platform===o.Platform.IOS?this._platformType=f.IOS:o.platform===o.Platform.WECHAT_GAME&&(this._platformType=f.Wechat)}needSubpackages(){return this._platformType===f.Wechat}}).instance=null,a=h))||a);t._RF.pop()}}}));

System.register("chunks:///_virtual/PrefabManager.ts",["cc","./GameConfig.ts"],(function(e){var r,t,a,n,s,c;return{setters:[function(e){r=e.cclegacy,t=e._decorator,a=e.Component,n=e.resources,s=e.Prefab},function(e){c=e.ResPath}],execute:function(){var o,f;r._RF.push({},"f2c48JwRppBvYXSl/psh9rl","PrefabManager",void 0);const{ccclass:l,property:i}=t;e("PrefabManager",l("PrefabManager")(((f=class e extends a{constructor(){super(...arguments),this.prefabs={}}static getInstance(){return e.instance}onLoad(){e.instance=this}async load(){return new Promise(((r,t)=>{let a="",o="",f=0;for(let l=0;l<c.prefabPath.length;l++)a=e.baseUrl+c.prefabPath[l],n.loadDir(a,s,((e,a)=>{if(e)t(e);else{for(let e=0;e<a.length;e++)o=a[e].name,this.prefabs[o]=a[e];f++,f===c.prefabPath.length&&r(a)}}))}))}get(e){return this.prefabs.hasOwnProperty(e)?this.prefabs[e]:null}}).baseUrl="/prefab",f.instance=null,o=f))||o);r._RF.pop()}}}));

System.register("chunks:///_virtual/RuHua.ts",["cc","./TDGame.ts","./AudioManager.ts"],(function(t){var e,n,s,a,h;return{setters:[function(t){e=t.cclegacy,n=t._decorator,s=t.Component},function(t){a=t.TDGame},function(t){h=t.AudioManager}],execute:function(){var c,i;e._RF.push({},"850cek+NzxNS7lZhVXonh1d","RuHua",void 0);const{ccclass:r,property:u}=n;t("RuHua",r("RuHua")(((i=class t extends s{constructor(){super(...arguments),this._hp=3}get hp(){return this._hp}set hp(t){this._hp=t,this.updateHearts(),this.hp<=0&&this.death()}static getInstance(){return t.instance}onLoad(){t.instance=this}start(){}reset(){this.hp=3}updateHearts(){let t=this.node.getChildByName("hearts");for(let e=0;e<t.children.length;e++)this.hp>e?t.children[e].active=!0:t.children[e].active=!1}damage(t){h.getInstance().playSnd("桃子减血"),t?this.hp-=3:this.hp--}death(){a.getInstance().gameOver()}update(t){}}).instance=null,c=i))||c);e._RF.pop()}}}));

System.register("chunks:///_virtual/shopManager.ts",["cc","./PrefabManager.ts","./homeBottom.ts","./Utils.ts","./SpriteManager.ts","./Global.ts","./ToastManager.ts","./successAlert.ts","./AudioManager.ts","./httpService.ts"],(function(t){var e,n,o,i,a,s,r,c,d,l,g,h,u,m,p,C,f,I;return{setters:[function(t){e=t.cclegacy,n=t.Component,o=t.instantiate,i=t.find,a=t.Button,s=t.Sprite,r=t.Label,c=t.Vec3,d=t._decorator},function(t){l=t.PrefabManager},function(t){g=t.homeBottom},function(t){h=t.default},function(t){u=t.SpriteManager},function(t){m=t.Global},function(t){p=t.ToastManager},function(t){C=t.successAlert},function(t){f=t.AudioManager},function(t){I=t.default}],execute:function(){var y;e._RF.push({},"368ffC4CPBItaCmBFXFP1lv","shopManager",void 0);const{ccclass:b,property:v}=d;t("shopManager",b("shopManager")(y=class extends n{constructor(){super(...arguments),this.refreshCount=0,this.hasBuyFruid=[],this.boxOpenFruit={},this.httpService=void 0,this.alertContainer=null,this.loadingContainer=null}onLoad(){this.httpService=new I,this.alertContainer=this.node.getChildByName("alert"),this.loadingContainer=this.node.getChildByName("loading");let t=o(l.getInstance().get("alert"));this.alertContainer.addChild(t),this.alertContainer.active=!1,t=o(l.getInstance().get("loading")),this.loadingContainer.addChild(t),this.loadingContainer.active=!1,this.loadShopData()}start(){let t=o(l.getInstance().get("bottom"));t.getComponent(g).init(0),this.node.getChildByName("bottom").addChild(t),t=o(l.getInstance().get("header")),this.node.getChildByName("header").addChild(t)}onRefreshClick(){console.log("刷新次数:"+this.refreshCount),f.getInstance().playSnd("clickBtn"),this.hasBuyFruid=[],this.refreshCount+=1,console.log("次数:"+this.refreshCount);const t=i("ScrollView/view/content/discount-shop/refresh",this.node);if(this.refreshCount>20)return t.getComponent(a).interactable=!1,t.getComponent(s).grayscale=!0,void(t.getChildByName("icon").getComponent(s).grayscale=!0);const e=Object.values(m.Instance.todayShop),n=this.getRandomProducts(e,6);localStorage.setItem("shop-discount-prod",JSON.stringify(n)),localStorage.setItem("shop-discount-buy",""),this.loadShopData();i("ScrollView/view/content/discount-shop/tips",this.node).getComponent(r).string=`Only ${20-this.refreshCount} times left today`}async loadShopData(){const t=m.Instance.todayShop;this.createProducts(t);const e=i("ScrollView/view/content/free",this.node);e.getChildByPath("tabContent/diamond/num").getComponent(r).string="x"+m.Instance.getConfig("freeDiamonds"),e.getChildByPath("tabContent/gold/num").getComponent(r).string="x"+m.Instance.getConfig("freeGolds");let n=m.Instance.getConfig("buyDiamondPrice");n=n.split(";");for(let t=0;t<n.length;t++){let o=n[t].split(",");const i=e.getChildByPath("tabContent/diamond-"+(t+1));i.getChildByName("num").getComponent(r).string="x"+o[1],i.getChildByPath("buy/text").getComponent(r).string=o[0]+" U"}this.disableGetFreeBtn();const o=i("ScrollView/view/content/box",this.node);o.getChildByPath("box1/buy/price").getComponent(r).string=m.Instance.getConfig("boxPrice"),o.getChildByPath("box2/buy/price").getComponent(r).string=m.Instance.getConfig("bigBoxPrice")}createProducts(t){const e=localStorage.getItem("shop-discount-prod");let n;if(h.isEmpty(e)){const e=Object.values(t);n=this.getRandomProducts(e,6),localStorage.setItem("shop-discount-prod",JSON.stringify(n))}else n=JSON.parse(e);const d=localStorage.getItem("shop-discount-buy");let g=[];h.isEmpty(d)||(g=JSON.parse(d));const m=i("ScrollView/view/content/discount-shop/item",this.node);m.removeAllChildren();let p=1;n.forEach((t=>{const e=o(l.getInstance().get("shopItem")),n=e.getChildByName("num");n&&(n.getComponent(r).string="x"+t.fragments);const d=e.getChildByName("title");d&&(d.getComponent(r).string=t.name);const h=i("buy/icon",e).getComponent(s),C=i("buy/text",e).getComponent(r),f=parseInt(t.diamonds);f>0?(h.spriteFrame=u.getInstance().get("diamond"),C.string=f.toString()):(h.spriteFrame=u.getInstance().get("gold"),C.string=t.gold);let I=u.getInstance().get(t.fruit_id+"-1");const y=i("img/icon",e),b=I.originalSize;let v=new c(1,1,1);b.width>300||b.height>300?(v.x=.3,v.y=.3):(b.width>200||b.height>200)&&(v.x=.5,v.y=.5),y.getComponent(s).spriteFrame=I,y.setScale(v);let B="green-slip";if(2==t.quality?B="blue-slip":3==t.quality&&(B="purple-slip"),i("img/bg",e).getComponent(s).spriteFrame=u.getInstance().get(B),g.indexOf(p)>=0){const t=e.getChildByName("buy");this.setDiscountItemBuyNodeDone(t)}else{const n=e.getChildByName("buy").getComponent(a);let o={fruitId:t.fruit_id,storeId:parseInt(t.id),gold:parseInt(t.gold),diamond:f,count:t.fragments,level:t.quality,currentFruitName:t.fruit_id+"-1",sortIndex:p};n.node.on(a.EventType.CLICK,(()=>this.onBuyButtonClick(o,e.getChildByName("buy"))),this)}m.addChild(e),p++}))}getRandomProducts(t,e){const n=[],o=[...t];for(;n.length<e&&o.length>0;){const t=Math.floor(Math.random()*o.length),e=o.splice(t,1)[0];n.push(e)}return n}async onBuyButtonClick(t,e){if(f.getInstance().playSnd("clickBtn"),this.hasBuyFruid.indexOf(t.sortIndex)>=0)return;if(t.diamond>0){if(m.Instance.get("diamonds")<t.diamond)return void p.show("Not Enough Diamonds",2)}else if(t.gold>0&&m.Instance.get("gold")<t.gold)return void p.show("Not Enough Golds",2);this.loadingContainer.active=!0;let n=await this.httpService.postDataToService("shop/buyFruitFragment",{shopId:t.storeId});if(this.loadingContainer.active=!1,n.code)return void p.show(n.msg);let o=parseInt(n.costDiamonds);o>0&&m.Instance.updateDiamonds(-Math.abs(o)),o=parseInt(n.costGlods),o>0&&m.Instance.updateGolds(-Math.abs(o));const i=parseInt(n.addFragment);m.Instance.updateFruit();const a=this.alertContainer.getChildByName("alert");let s=[{fruitId:t.fruitId,iconFrameName:t.currentFruitName,num:i,level:t.level,needScale:t.needScale}];a.getComponent(C).updateItems(s),a.active=!0,this.alertContainer.active=!0,this.hasBuyFruid.push(t.sortIndex),localStorage.setItem("shop-discount-buy",JSON.stringify(this.hasBuyFruid)),this.setDiscountItemBuyNodeDone(e)}setDiscountItemBuyNodeDone(t){t.getComponent(a).interactable=!1,t.getComponent(s).grayscale=!0,t.getChildByName("icon").active=!1,t.getChildByName("text").active=!1,t.getChildByName("done").active=!0}async onFreeButtonClick(t,e){f.getInstance().playSnd("clickBtn");let n=1==e?"lastGetFreeGoldsTime":"lastGetFreeDiamondsTime",o=m.Instance.get(n),i=Math.floor(Date.now()/1e3);if(i<o+86400)return p.show("Cannot claim now",2),void console.log("距离上次获取还不到24小时");const a=this.alertContainer.getChildByName("alert");let s=1==e?"shop/getFreeGold":"shop/getFreeDiamonds",r=1==e?"golds":"diamonds";try{this.loadingContainer.active=!0;let t=await this.httpService.postDataToService(s,{});if(this.loadingContainer.active=!1,t.code)return void p.show(t.msg);const o=parseInt(t.addAmount);1==e?m.Instance.updateGolds(o):m.Instance.updateDiamonds(o);const c=[{iconFrameName:r,num:o}];a.getComponent(C).updateItems(c),m.Instance.set(n,i),a.active=!0,this.alertContainer.active=!0}catch(t){console.error("Error fetching data:",t),p.show("An error occurred. Please try again later.")}finally{this.disableGetFreeBtn()}}disableGetFreeBtn(){const t=i("ScrollView/view/content/free",this.node),e=(e,n)=>{if(Math.floor(Date.now()/1e3)<n+86400){const n=t.getChildByPath(e);n.getComponent(s).grayscale=!0,n.getComponent(a).interactable=!1}},n=m.Instance.get("lastGetFreeGoldsTime"),o=m.Instance.get("lastGetFreeDiamondsTime");e("tabContent/gold/buy",n),e("tabContent/diamond/buy",o)}async onBoxButtonClick(t,e){f.getInstance().playSnd("clickBtn");let n=0,o=parseInt(e);if(n=1==o?m.Instance.getConfig("boxPrice"):m.Instance.getConfig("bigBoxPrice"),m.Instance.get("diamonds")<n)return void p.show("Out of diamonds",2);this.loadingContainer.active=!0;const i=await this.httpService.postDataToService("shop/openBox",{boxType:o});this.loadingContainer.active=!1,h.isEmpty(i.code)?(this.boxOpenFruit=i,m.Instance.updateDiamonds(-n),this.onBoxAnimationFinished()):p.show(i.msg)}getRandomElements(t,e){const n=[],o=[...t];for(let t=0;t<e;t++){const t=h.getRandomInt(0,o.length-1);n.push(...o.splice(t,1))}return n}distributeFragments(t,e,n,o){void 0===n&&(n=1),void 0===o&&(o=t);let i=[],a=t;for(let t=0;t<e;t++){const s=Math.min(a-(e-t-1),o);let r=h.getRandomInt(n,s);r=r>0?r:1,i.push(r),a-=r}return i}openBox(t){const e=1==t?30:150,n=m.Instance.fruits;let o=[],i=[],a=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const e=n[t];let s=parseInt(e.quality);1==s?o.push(e.id):2==s?a.push(e.id):3==s&&i.push(e.id)}let s=[],r=[],c=[],d=[];if(1===t){Math.random()<.1&&(s=this.distributeFragments(1,1),r=this.getRandomElements(i,1));const t=h.getRandomInt(6,8),n=e-s.reduce(((t,e)=>t+e),0);c=this.distributeFragments(n,t,1,3),d=this.getRandomElements(a,t);const l=e-s.reduce(((t,e)=>t+e),0)-c.reduce(((t,e)=>t+e),0),g=h.getRandomInt(1,3),u=this.distributeFragments(l,g);return{1:this.getRandomElements(o,g).map(((t,e)=>({fruitID:t,count:u[e]}))),3:r.map(((t,e)=>({fruitID:t,count:s[e]}))),2:d.map(((t,e)=>({fruitID:t,count:c[e]})))}}{const t=Math.floor(e/2),n=h.getRandomInt(1,3),l=this.distributeFragments(t,n),g=this.getRandomElements(o,n),u=h.getRandomInt(2,4),m=h.getRandomInt(1,3);s=this.distributeFragments(u,m),r=this.getRandomElements(i,m);const p=e-t-s.reduce(((t,e)=>t+e),0),C=h.getRandomInt(6,8);c=this.distributeFragments(p,C),d=this.getRandomElements(a,C);return{1:g.map(((t,e)=>({fruitID:t,count:l[e]}))),3:r.map(((t,e)=>({fruitID:t,count:s[e]}))),2:d.map(((t,e)=>({fruitID:t,count:c[e]})))}}}onBoxAnimationFinished(){this.node.getChildByName("boxAnimated").active=!1;const t=this.alertContainer.getChildByName("alert");let e=[];if(this.boxOpenFruit.addGold){const t=this.boxOpenFruit.addGold;e.push({iconFrameName:"golds",num:t,level:1})}if(this.boxOpenFruit.fruitDetails){const t=this.boxOpenFruit.fruitDetails;for(const n in Object.keys(t)){const o=t[n],i=o.fruitId;e.push({level:o.quality,fruitId:i,iconFrameName:i+"-1",num:o.fragments})}m.Instance.updateFruit()}e.length<0?console.log("chipItem 为空"):(t.getComponent(C).updateItems(e),t.active=!0,this.alertContainer.active=!0)}async onBuyDiamondButtonClick(t,e){f.getInstance().playSnd("clickBtn");const n=t.currentTarget.getComponent(a);n.interactable=!1;let o=m.Instance.getConfig("buyDiamondPrice");o=o.split(";");let i=0,s=0;for(let t=0;t<o.length;t++){let n=o[t].split(",");parseInt(n[0])==e&&(i=parseInt(n[1]),s=parseInt(n[0]))}if(0==i||0==s)return void p.show("ERROR",2);const r=await m.Instance.sendTransfer(m.Instance.tgData.id);if(999==r.code)return void(n.interactable=!0);const c=r.msg;if(1==r.code)return n.interactable=!0,void p.show(c,2);const d=this.alertContainer.getChildByName("alert");m.Instance.updateDiamonds(Math.abs(i));let l=[{iconFrameName:"diamonds",num:i,tips:c}];d.getComponent(C).updateItems(l),d.active=!0,this.alertContainer.active=!0,n.interactable=!0}})||y);e._RF.pop()}}}));

System.register("chunks:///_virtual/SpriteManager.ts",["cc","./GameConfig.ts"],(function(e){var t,r,s,n,i,a;return{setters:[function(e){t=e.cclegacy,r=e._decorator,s=e.Component,n=e.resources,i=e.SpriteFrame},function(e){a=e.SpritesDir}],execute:function(){var c,o;t._RF.push({},"dff45/tXA5F4o0KAR1IyZnj","SpriteManager",void 0);const{ccclass:l,property:p}=r;e("SpriteManager",l("SpriteManager")(((o=class e extends s{constructor(){super(...arguments),this.sprites={}}static getInstance(){return e.instance}onLoad(){e.instance=this}start(){}async load(){var t=a.slice(0,a.length);return new Promise(((r,s)=>{let a="",c="";for(let o=0;o<t.length;o++)a=e.baseUrl+t[o],n.loadDir(a,i,((e,t)=>{if(e)s(e);else{for(let e=0;e<t.length;e++)c=t[e].name,this.sprites[c]=t[e];r(t)}}))}))}get(e){return this.sprites.hasOwnProperty(e)?this.sprites[e]:null}}).baseUrl="/sprite",o.instance=null,c=o))||c);t._RF.pop()}}}));

System.register("chunks:///_virtual/StringUtil.ts",["cc"],(function(t){var e;return{setters:[function(t){e=t.cclegacy}],execute:function(){e._RF.push({},"8e3b8AwMP9MbL8eGR8WR33R","StringUtil",void 0);class r{static stringFormat(t){if(0==(arguments.length<=1?0:arguments.length-1)||null==t)return"";for(let e=0;e<(arguments.length<=1?0:arguments.length-1);e++){let r="{"+e+"}";t=t.replace(r,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}static format(t){if(0==(arguments.length<=1?0:arguments.length-1)||null==t)return"";for(let e=0;e<(arguments.length<=1?0:arguments.length-1);e++){let r="{"+e+"}";t=t.replace(r,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}static FormatTimeMMSS(t){let e=t.getMinutes(),r=e<10?"0"+e:e.toString(),n=t.getSeconds();return r+":"+(n<10?"0"+n:n.toString())}static FormatTimeHHMM(t){let e=t.getHours(),r=e<10?"0"+e:e.toString(),n=t.getMinutes();return r+":"+(n<10?"0"+n:n.toString())}static FormatTimeHHMMSS(t){let e=t.getHours(),r=t.getMinutes(),n=t.getSeconds();return(e<10?"0"+e:e.toString())+":"+(r<10?"0"+r:r.toString())+":"+(n<10?"0"+n:n.toString())}static FormatTimeYMD(t,e){let n=e.getFullYear(),i=e.getMonth()+1,o=e.getDate(),l=i<10?"0"+i:i,a=o<10?"0"+o:o;return r.format(r.Localize(t),n,l,a)}static FormatTimeYMDHHMM(t,e){let n=e.getFullYear(),i=e.getMonth()+1,o=e.getDate(),l=e.getHours(),a=e.getMinutes(),g=i<10?"0"+i:i,c=o<10?"0"+o:o,u=l<10?"0"+l:l.toString(),s=a<10?"0"+a:a.toString();return r.format(r.Localize(t),n,g,c,u,s)}static FormatTimeMD(t,e){let n=e.getMonth()+1,i=e.getDate(),o=n<10?"0"+n:n,l=i<10?"0"+i:i;return r.format(r.Localize(t),o,l)}static FormatTimeBySec(t){if(t>0){let e="",n="",i="",o="",l=Math.floor(t/3600);n=""+l,l<10&&(n="0"+l);let a=Math.floor(t%3600/60);i=""+a,a<10&&(i="0"+a);let g=t%60;return o=""+g,g<10&&(o="0"+g),e=t>=3600?r.format("{0}:{1}:{2}",n,i,o):r.format("{1}:{2}",n,i,o),e}return""}static colorString(t,e){return`<color=#703B2C>${t}</c>`}static Localize(t){return String(t)}}t("default",r),e._RF.pop()}}}));

System.register("chunks:///_virtual/successAlert.ts",["cc","./PrefabManager.ts","./SpriteManager.ts","./AudioManager.ts","./Utils.ts","./Global.ts"],(function(e){var t,i,n,s,o,a,r,l,c,h,m,d,u,g,C;return{setters:[function(e){t=e.cclegacy,i=e.Component,n=e.Input,s=e.BlockInputEvents,o=e.instantiate,a=e.Vec3,r=e.UITransform,l=e.Sprite,c=e.Label,h=e._decorator},function(e){m=e.PrefabManager},function(e){d=e.SpriteManager},function(e){u=e.AudioManager},function(e){g=e.default},function(e){C=e.Global}],execute:function(){var p;t._RF.push({},"18ed1H/xNhJ0rwkPu3fStae","successAlert",void 0);const{ccclass:f}=h;e("successAlert",f("successAlert")(p=class extends i{constructor(){super(...arguments),this.containerNode=null,this.desc=null,this.num=null,this.fireworkCount=500,this.minX=-300,this.maxX=300,this.minY=-640,this.maxY=640,this.delay=.5,this.itemContainer=null,this.itemContainer_1=null,this.itemPrefab=null}onLoad(){this.node.on(n.EventType.TOUCH_END,this.onNodeClick,this),this.node.addComponent(s),this.itemContainer=this.node.getChildByName("imgContent"),this.itemContainer_1=this.node.getChildByName("imgContent-1"),this.itemPrefab=m.getInstance().get("chipFruit")}start(){this.containerNode=this.node.getChildByName("container"),this.generateFireworksWithDelay()}generateFireworksWithDelay(){for(let e=0;e<this.fireworkCount;e++)this.scheduleOnce((()=>{this.createFirework()}),e*this.delay)}createFirework(){const e=o(m.getInstance().get("boomfire")),t=this.getRandom(this.minX,this.maxX),i=this.getRandom(this.minY,this.maxY);e.setPosition(new a(t,i,0)),this.containerNode.addChild(e)}getRandom(e,t){return Math.random()*(t-e)+e}onNodeClick(e){u.getInstance().stopSnd("firework"),this.itemContainer.removeAllChildren(),this.itemContainer_1.removeAllChildren(),this.node.active=!1}setSize(e,t,i){const n=e.node.getComponent(r);n&&n.setContentSize(t,i)}updateItems(e){u.getInstance().playSnd("firework");let t="",i=!1;e.length>=6&&(i=!0),i?(this.itemContainer.active=!0,this.itemContainer_1.active=!1):(this.itemContainer.active=!1,this.itemContainer_1.active=!0),e.forEach((e=>{const n=o(this.itemPrefab),s=n.getChildByName("bg").getComponent(l);let r="";e.level&&(r="green-slip",2==e.level?r="blue-slip":3==e.level&&(r="purple-slip")),s.spriteFrame=r?d.getInstance().get(r):null;const h=n.getChildByName("icon"),m=h.getComponent(l);let u=d.getInstance().get(e.iconFrameName);const p=e.fruitId;if(p){let e=new a(1,1,1);const t=C.Instance.fruitNeedScaleX,i=C.Instance.fruitNeedScaleY;-1!=t.indexOf(p)&&(e.x=.5),-1!=i.indexOf(p)&&(e.y=.5),1010==p&&(e.x=.3),h.scale=e}m.spriteFrame=u,n.getChildByName("num").getComponent(c).string="x"+e.num,i?this.itemContainer.addChild(n):this.itemContainer_1.addChild(n),e.tips&&g.isEmpty(t)&&(t=e.tips)}));const n=this.node.getChildByName("tips");n.active=!1,g.isEmpty(t)||(n.active=!0,n.getComponent(c).string=t)}})||p);t._RF.pop()}}}));

System.register("chunks:///_virtual/TDGame.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Pack.ts","./GameScene.ts","./MainUI.ts","./FruitManager.ts","./AudioManager.ts","./PrefabManager.ts","./NodePoolMap.ts","./GameConfig.ts","./GameLevel.ts","./Global.ts"],(function(e){var t,a,n,i,s,o,c,l,r,g,h,m,d,u,p,v,f,S;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.initializerDefineProperty},function(e){n=e.cclegacy,i=e.Node,s=e._decorator,o=e.Component,c=e.instantiate,l=e.director},function(e){r=e.Pack},function(e){g=e.GameScene},function(e){h=e.MainUI},function(e){m=e.FruitManager},function(e){d=e.AudioManager},function(e){u=e.PrefabManager},function(e){p=e.default},function(e){v=e.NodePoolName},function(e){f=e.GameLevel},function(e){S=e.Global}],execute:function(){var k,P,I,G,C,M;n._RF.push({},"52515KrTpNGLJw/KD5sq8Sg","TDGame",void 0);const{ccclass:_,property:L}=s;let N=e("GameState",function(e){return e[e.None=0]="None",e[e.fillPack=1]="fillPack",e[e.editPack=2]="editPack",e[e.gameing=3]="gameing",e[e.gameover=4]="gameover",e}({}));e("TDGame",(k=_("TDGame"),P=L(i),k(((M=class e extends o{constructor(){super(...arguments),a(this,"loadingContainer",C,this),this.gameScene=null,this.pack=null,this.gameLevel=null,this.timeTick=0,this.silverCount=void 0,this._gameState=N.None,this._exp=0,this._level=1}get gameState(){return this._gameState}set gameState(e){this._gameState=e}static getInstance(){return e.instance}set exp(e){this._exp+=e,this._exp>150&&(this._exp-=150,this.level++),g.getInstance().setExpProgress(this._exp/150)}get exp(){return this._exp}set level(e){this._level=e,g.getInstance().updateLevelLabel(),1!=e&&(h.getInstance().showLevelupUI(!0),this._gameState=N.None)}get level(){return this._level}get silver(){return this.silverCount}addSilver(e){this.silverCount+=e}onLoad(){e.instance=this,this.silverCount=parseInt(S.Instance.getConfig("defaultSliverPerGame")),this.init()}start(){this.startGame()}init(){this.gameScene=this.node.parent.getChildByName("gameScene").getComponent(g),this.pack=this.gameScene.node.getChildByName("pack").getComponent(r);this.gameScene.node.getChildByName("path");this.gameLevel=this.gameScene.node.getChildByName("gameLevel").getComponent(f);let e=u.getInstance().get("monster");p.createPool(v.Monster,e,50),e=u.getInstance().get("bullet"),p.createPool(v.Bullet,e,50),e=u.getInstance().get("death"),p.createPool(v.DeathEffect,e,30);let t=c(u.getInstance().get("loading"));this.loadingContainer.addChild(t),this.loadingContainer.active=!1}startGame(){this.pack.init(),this.enterFillPackMode(),m.getInstance().spawnGameObjs(),this.exp=0,this.level=1}enterFillPackMode(){this.gameState=N.fillPack,this.gameScene.enterFillPackMode(),this.pack.enterFillPackMode(),h.getInstance().enterFillPackMode(),m.getInstance().showAll()}enterEditPackMode(){this.gameState=N.editPack,this.gameScene.enterEditPackMode(),this.pack.enterEditPackMode(),h.getInstance().enterEditPackMode()}async enterGame(){d.getInstance().playSnd("startFight"),h.getInstance().enterGame(),this.pack.enterGame(),m.getInstance().show(!1),await this.gameScene.enterGame(),this.gameState=N.gameing,this.gameLevel.startNextWave()}gameOver(){this.gameState=N.gameover,h.getInstance().showLoseUI(!0)}backToFightHome(){this.gameState=N.gameover,l.loadScene("fightHome")}restartGame(){this.pack.reset(),this.gameScene.reset(),this.enterFillPackMode(),m.getInstance().clear(),m.getInstance().spawnGameObjs()}openLoading(){this.loadingContainer.active=!0}closeLoading(){this.loadingContainer.active=!1}update(e){}}).instance=null,C=t((G=M).prototype,"loadingContainer",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=G))||I));n._RF.pop()}}}));

System.register("chunks:///_virtual/telegram-web.ts",["cc"],(function(e){var t,r,n;return{setters:[function(e){t=e.cclegacy,r=e.sys,n=e._decorator}],execute:function(){var p,s;t._RF.push({},"cb8407D3zdPOIUY4npAWBMx","telegram-web",void 0);const{ccclass:a,property:i}=n,o=new Promise(((e,t)=>{if(r.platform===r.Platform.MOBILE_BROWSER||r.platform===r.Platform.DESKTOP_BROWSER){const r=document.createElement("script");r.src="https://telegram.org/js/telegram-web-app.js",r.async=!0,r.onload=()=>{const t=setInterval((()=>{window.Telegram&&window.Telegram.WebApp&&(e(window.Telegram.WebApp),clearInterval(t))}),100)},r.onerror=()=>t(new Error("Unable to load TelegramWebApp SDK, please check logs.")),document.head.appendChild(r)}}));e("TelegramWebApp",a("TelegramWebApp")(((s=class e{constructor(){this._tgWebAppJS=null}static get Instance(){return e._instance||(e._instance=new e),e._instance}async init(){return this._tgWebAppJS=await o,this._tgWebAppJS?Promise.resolve({success:!0}):Promise.resolve({success:!1})}openTelegramLink(e){this._tgWebAppJS?this._tgWebAppJS.openTelegramLink(e):console.error("telegram web app is not inited!")}openLink(e,t){void 0===t&&(t={}),this._tgWebAppJS?this._tgWebAppJS.openLink(e,t):console.error("telegram web app is not inited!")}share(e,t){const r="https://t.me/share/url?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t||"");this.openTelegramLink(r)}shareToStory(e,t,r,n){if(!this._tgWebAppJS)return void console.error("telegram web app is not inited!");const p={text:t,widget_link:{url:r,name:n}};this._tgWebAppJS.shareToStory(e,p)}getTelegramWebApp(){return this._tgWebAppJS}getTelegramWebAppInitData(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe:(console.error("telegram web app is not inited!"),null)}getTelegramUser(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe.user:(console.error("telegram web app is not inited!"),null)}getTelegramStartParam(){return this._tgWebAppJS?this._tgWebAppJS.initDataUnsafe.start_param:(console.error("telegram web app is not inited!"),null)}getTelegramInitData(){return this._tgWebAppJS?this._tgWebAppJS.initData:(console.error("telegram web app is not inited!"),null)}openInvoice(e,t){if(!this._tgWebAppJS)return console.error("telegram web app is not inited!"),null;this._tgWebAppJS.openInvoice(e,t)}alert(e){this._tgWebAppJS.showAlert(e)}})._instance=void 0,p=s))||p);t._RF.pop()}}}));

System.register("chunks:///_virtual/timeCountDown.ts",["cc"],(function(t){var e,n,o,s;return{setters:[function(t){e=t.cclegacy,n=t.Component,o=t.Label,s=t._decorator}],execute:function(){var i;e._RF.push({},"fc6218YCpdOEYKE05sKlME4","timeCountDown",void 0);const{ccclass:a,property:r}=s;t("timeCountDown",a("timeCountDown")(i=class extends n{constructor(){super(...arguments),this.targetHour=24,this.targetMinute=0,this.endOfDay=null}onLoad(){this.resetCountdown(),this.schedule(this.updateCountdown,1)}updateCountdown(){const t=this.calculateRemainingTime();t.totalSeconds>0?this.updateLabel(t):this.resetCountdown()}calculateRemainingTime(){const t=new Date,e=Math.floor((this.endOfDay.getTime()-t.getTime())/1e3),n=Math.floor(e/3600),o=Math.floor(e%3600/60),s=e%60;var i=n.toString();n<10&&(i="0"+i);var a=o.toString();o<10&&(a="0"+a);var r=s.toString();return s<10&&(r="0"+r),{totalSeconds:e,hours:i,minutes:a,seconds:r}}updateLabel(t){if(t)this.node.getComponent(o).string=`${t.hours}:${t.minutes}:${t.seconds}`;else{const t=this.calculateRemainingTime();this.node.getComponent(o).string=`${t.hours}:${t.minutes}:${t.seconds}`}}resetCountdown(){const t=new Date;this.endOfDay=new Date(t.getFullYear(),t.getMonth(),t.getDate(),this.targetHour,this.targetMinute,0,0),t>=this.endOfDay&&this.endOfDay.setDate(this.endOfDay.getDate()+1),this.updateLabel()}})||i);e._RF.pop()}}}));

System.register("chunks:///_virtual/Tip.ts",["cc"],(function(t){var e,i,s,n,a,o,c;return{setters:[function(t){e=t.cclegacy,i=t._decorator,s=t.Component,n=t.Label,a=t.UIOpacity,o=t.tween,c=t.v3}],execute:function(){var l,p;e._RF.push({},"abb34fkJ9FHjp36b0l72vWj","Tip",void 0);const{ccclass:h,property:r}=i;t("Tip",h("Tip")(((p=class t extends s{constructor(){super(...arguments),this.label=null,this.opacity=null}static getInstance(){return t.instance}onLoad(){t.instance=this,this.label=this.node.getChildByName("label").getComponent(n),this.opacity=this.label.node.getComponent(a)}start(){}showTip(t){this.label.node.active||(this.label.string=t,this.label.node.setPosition(0,0,0),this.label.node.active=!0,this.opacity.opacity=255,this.scheduleOnce((()=>{o(this.label.node).to(.6,{position:c(0,100,0)}).start(),o(this.opacity).to(.6,{opacity:0}).call((()=>{this.label.node.active=!1})).start()}),1))}}).instance=null,l=p))||l);e._RF.pop()}}}));

System.register("chunks:///_virtual/ToastManager.ts",["cc","./PrefabManager.ts"],(function(t){var e,n,a,s,o,r,c,i,l;return{setters:[function(t){e=t.cclegacy,n=t._decorator,a=t.Component,s=t.instantiate,o=t.Label,r=t.director,c=t.tween,i=t.Vec3},function(t){l=t.PrefabManager}],execute:function(){var d,g;e._RF.push({},"91a48FihBVAgacGNwA0CWo1","ToastManager",void 0);const{ccclass:u,property:h}=n;t("ToastManager",u("Toast")(((g=class t extends a{constructor(){super(...arguments),this.toastPrefab=null}onLoad(){this.toastPrefab=l.getInstance().get("Toast"),t.instance=this}static show(e,n){void 0===n&&(n=3),t.instance?t.instance.showToast(e,n):console.error("ToastManager instance is not initialized!")}showToast(t,e){const n=s(this.toastPrefab),a=n.getComponentInChildren(o);a&&(a.string=t);const l=r.getScene().getChildByName("Canvas");l?(l.addChild(n),n.setPosition(0,0,0),c(n).to(1,{position:new i(0,300,0)}).delay(e-1).call((()=>{n.destroy()})).start()):console.error("Canvas node not found in the scene!")}start(){}update(t){}}).instance=null,d=g))||d);e._RF.pop()}}}));

System.register("chunks:///_virtual/Utils.ts",["cc"],(function(t){var e,r,n,a,s;return{setters:[function(t){e=t.director,r=t.Canvas,n=t.tween,a=t.Vec3,s=t.cclegacy}],execute:function(){s._RF.push({},"0552fJbpsRKOanuaOVBav7Q","Utils",void 0);class o{static getNodeFromScene(t){return e.getScene().getChildByName(t)}static getNodeFromCanvas(t){let e=o.getNodeFromScene("Canvas");return e?e.getChildByName(t):null}static getCanvas(){let t=o.getNodeFromScene("Canvas");return t?t.getComponent(r):null}static GetorAddComponent(t,e){var r=t.getComponent(e);return null!=r&&null!=r||(r=t.addComponent(e)),r}static async sleep(t){return new Promise((e=>{setTimeout((()=>{e("")}),t)}))}static generateUniqueID(){return Math.random().toString(36).substr(2,9)}static arraysAreEqual(t,e){return JSON.stringify(t)===JSON.stringify(e)}static parseJsonData(t){const{header:e,rows:r,cname:n}=t,a={};return a[n]=Object.values(r).map((t=>{const r={};return e.forEach(((e,n)=>{r[e]=t[n]})),r})),a}static transformData(t){const{header:e,rows:r,cname:n}=t,a={};for(const t in r)if(r.hasOwnProperty(t)){const n=r[t],s={};e.forEach(((t,e)=>{s[t]=n[e]})),a[t]=s}const s={};return s[n]=a,s}static startRotation(t,e,r){n(t).repeatForever(n().to(e/2,{eulerAngles:new a(0,0,r)}).to(e/2,{eulerAngles:new a(0,0,-r)}).to(e/2,{eulerAngles:new a(0,0,r)}).to(e/2,{eulerAngles:new a(0,0,-r)}).call((()=>{t.eulerAngles=new a(0,0,0)})).delay(1)).start()}static getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}static isEmpty(t){return null==t||(Array.isArray(t)||"string"==typeof t?0===t.length:"object"==typeof t&&0===Object.keys(t).length)}static formatNumber(t){if(0===t)return"0";if(t<1e4)return t.toString();const e=["K","W","M","B","T"];let r=-1;for(;t>=1e3&&r<e.length-1;)t/=1e3,r++;return t.toFixed(2).replace(/\.0$/,"")+(r>=0?e[r]:"")}static stringToHex(t){let e="";for(let r=0;r<t.length;r++)e+=t.charCodeAt(r).toString(16).padStart(2,"0");return e}}t("default",o),s._RF.pop()}}}));

System.register("chunks:///_virtual/victoryAlert.ts",["cc","./AudioManager.ts","./PrefabManager.ts","./SpriteManager.ts","./TDGame.ts","./Global.ts"],(function(e){var t,n,a,c,r,i,o,l,s,g,d,u,p;return{setters:[function(e){t=e.cclegacy,n=e.Component,a=e.Button,c=e.instantiate,r=e.Sprite,i=e.Vec3,o=e.Label,l=e._decorator},function(e){s=e.AudioManager},function(e){g=e.PrefabManager},function(e){d=e.SpriteManager},function(e){u=e.TDGame},function(e){p=e.Global}],execute:function(){var m;t._RF.push({},"0425fyltMFMkIrU+ROYn2M4","victoryAlert",void 0);const{ccclass:h,property:f}=l;e("victoryAlert",h("victoryAlert")(m=class extends n{onLoad(){}onBackBtnClick(e){const t=e.currentTarget.getComponent(a);t.interactable=!1,s.getInstance().playSnd("clickBtn"),u.getInstance().backToFightHome(),t.interactable=!0}updateItems(e){const t=this.node.getChildByPath("reword/content"),n=this.node.getChildByPath("reword/content-grid");t.removeAllChildren(),n.removeAllChildren();let a=!1;e.length>=6&&(a=!0),a?(n.active=!0,t.active=!1):(n.active=!1,t.active=!0);const l=p.Instance.fruitNeedScaleX,s=p.Instance.fruitNeedScaleY;e.forEach((e=>{const u=c(g.getInstance().get("chipFruit")),p=e.fruitId,m=u.getChildByName("bg").getComponent(r);let h="green-slip";e.level&&(2==e.level?h="blue-slip":3==e.level&&(h="purple-slip")),m.spriteFrame=h?d.getInstance().get(h):null;const f=u.getChildByName("icon"),v=f.getComponent(r);let y=d.getInstance().get(e.iconFrameName),C=new i(1,1,1);-1!=l.indexOf(p)&&(C.x=.5),-1!=s.indexOf(p)&&(C.y=.5),1010==p&&(C.x=.3),f.scale=C,v.spriteFrame=y,u.getChildByName("num").getComponent(o).string="x"+e.num,a?n.addChild(u):t.addChild(u)}))}})||m);t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});